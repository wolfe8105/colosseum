<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a1628">
<title>The Colosseum</title>

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Stripe CDN -->
<script src="https://js.stripe.com/v3/"></script>

<!-- V2 Modules -->
<script src="colosseum-config.js"></script>
<script src="colosseum-auth.js"></script>
<script src="colosseum-payments.js"></script>
<script src="colosseum-notifications.js"></script>
<script src="colosseum-paywall.js"></script>
<script src="colosseum-async.js"></script>
<script src="colosseum-share.js"></script>
<script src="colosseum-leaderboard.js"></script>
<script src="colosseum-scoring.js"></script>
<script src="colosseum-webrtc.js"></script>
<script src="colosseum-voicememo.js"></script>
<script src="colosseum-home.js"></script>
<script src="colosseum-arena.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Source+Sans+3:wght@400;600;700&display=swap');

  /* ============================================================
     MOBILE-FIRST CSS ‚Äî Base = phone (320px+)
     Breakpoints: 768px (tablet), 1100px (desktop)
     Decision 3.2: phone is default
     ============================================================ */

  :root {
    --navy: #0a1628;
    --navy-light: #132240;
    --navy-mid: #1a2d4a;
    --red: #cc2936;
    --red-hover: #e63946;
    --gold: #d4a843;
    --gold-dim: #b8922e;
    --white: #f0f0f0;
    --white-dim: #a0a8b8;
    --success: #2ecc71;
    --error: #e74c3c;
    --font-display: 'Bebas Neue', sans-serif;
    --font-body: 'Source Sans 3', sans-serif;

    /* Mobile dimensions */
    --nav-height: 52px;
    --bottom-nav-height: 56px;
    --ticker-height: 28px;
    --touch-min: 44px;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);
  }

  /* Tablet+ */
  @media (min-width: 768px) {
    :root {
      --nav-height: 56px;
      --bottom-nav-height: 64px;
      --ticker-height: 32px;
    }
  }

  /* Desktop */
  @media (min-width: 1100px) {
    :root {
      --nav-height: 60px;
    }
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; overflow: hidden; }

  body {
    font-family: var(--font-body);
    background: var(--navy);
    color: var(--white);
    display: flex;
    flex-direction: column;
    -webkit-tap-highlight-color: transparent;
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: 
      radial-gradient(ellipse at 20% 50%, rgba(204, 41, 54, 0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 20%, rgba(212, 168, 67, 0.04) 0%, transparent 50%),
      linear-gradient(180deg, var(--navy) 0%, #06101f 100%);
    z-index: -1;
  }

  /* ===== TOP NAV (mobile-first) ===== */
  .top-nav {
    height: calc(var(--nav-height) + var(--safe-top));
    padding-top: var(--safe-top);
    background: var(--navy-light);
    border-bottom: 1px solid rgba(212,168,67,0.15);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-left: max(12px, var(--safe-left));
    padding-right: max(12px, var(--safe-right));
    flex-shrink: 0;
    z-index: 100;
  }

  .top-nav .logo {
    font-family: var(--font-display);
    font-size: 22px;
    letter-spacing: 2px;
    color: var(--gold);
    text-transform: uppercase;
  }
  .top-nav .logo span { color: var(--red); }

  @media (min-width: 768px) {
    .top-nav .logo { font-size: 26px; letter-spacing: 3px; }
  }

  .top-nav-right {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* 44px minimum touch targets */
  .nav-icon-btn {
    width: var(--touch-min);
    height: var(--touch-min);
    border-radius: 50%;
    border: none;
    background: var(--navy-mid);
    color: var(--white-dim);
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    -webkit-tap-highlight-color: transparent;
  }
  @media (hover: hover) {
    .nav-icon-btn:hover { background: var(--navy); color: var(--white); }
  }
  .nav-icon-btn:active { background: var(--navy); color: var(--white); }

  .notification-dot {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 8px;
    height: 8px;
    background: var(--red);
    border-radius: 50%;
    border: 2px solid var(--navy-light);
  }

  .user-avatar-small {
    width: var(--touch-min);
    height: var(--touch-min);
    border-radius: 50%;
    border: 2px solid var(--gold-dim);
    background: var(--navy-mid);
    color: var(--gold);
    font-family: var(--font-display);
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  .user-avatar-small:active { border-color: var(--gold); }
  @media (hover: hover) {
    .user-avatar-small:hover { border-color: var(--gold); }
  }

  /* Token bar */
  .token-bar {
    display: flex;
    align-items: center;
    gap: 4px;
    background: rgba(212,168,67,0.1);
    padding: 6px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    color: var(--gold);
    min-height: 32px;
  }

  /* ===== TICKER ===== */
  .ticker-bar {
    height: var(--ticker-height);
    background: var(--red);
    display: flex;
    align-items: center;
    overflow: hidden;
    flex-shrink: 0;
  }

  .ticker-label {
    background: rgba(0,0,0,0.3);
    padding: 0 8px;
    height: 100%;
    display: flex;
    align-items: center;
    font-family: var(--font-display);
    font-size: 11px;
    letter-spacing: 1px;
    white-space: nowrap;
    flex-shrink: 0;
  }
  @media (min-width: 768px) {
    .ticker-label { padding: 0 12px; font-size: 13px; letter-spacing: 2px; }
  }

  .ticker-scroll { flex: 1; overflow: hidden; position: relative; }

  .ticker-content {
    display: flex;
    gap: 32px;
    animation: tickerScroll 30s linear infinite;
    white-space: nowrap;
    padding-left: 100%;
    font-size: 12px;
    font-weight: 600;
  }
  .ticker-content span { white-space: nowrap; }

  @keyframes tickerScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* ===== CATEGORY TABS (horizontal scroll + snap) ===== */
  .category-tabs {
    display: flex;
    background: var(--navy-light);
    border-bottom: 1px solid rgba(255,255,255,0.06);
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    flex-shrink: 0;
  }
  .category-tabs::-webkit-scrollbar { display: none; }

  .cat-tab {
    padding: 0 14px;
    min-height: var(--touch-min);
    font-family: var(--font-display);
    font-size: 13px;
    letter-spacing: 1.5px;
    color: var(--white-dim);
    background: none;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    border-bottom: 3px solid transparent;
    scroll-snap-align: start;
    display: flex;
    align-items: center;
    flex-shrink: 0;
    -webkit-tap-highlight-color: transparent;
  }
  .cat-tab:active { color: var(--white); }
  .cat-tab.active { color: var(--white); border-bottom-color: var(--gold); }
  @media (hover: hover) {
    .cat-tab:hover { color: var(--white); }
  }
  @media (min-width: 768px) {
    .cat-tab { padding: 0 18px; font-size: 15px; letter-spacing: 2px; }
  }

  /* ===== MAIN CONTENT ===== */
  .main-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
  }

  .screen { display: none; padding: 12px; padding-bottom: 20px; }
  .screen.active { display: block; }
  @media (min-width: 768px) {
    .screen { padding: 16px 20px; }
  }
  @media (min-width: 1100px) {
    .screen { padding: 20px 24px; max-width: 800px; margin: 0 auto; }
  }

  /* ===== SECTION BANNER ===== */
  .section-banner {
    background: linear-gradient(135deg, var(--navy-mid), var(--navy-light));
    border: 1px solid rgba(212,168,67,0.12);
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 12px;
    position: relative;
    overflow: hidden;
  }
  .section-banner::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 4px;
    height: 100%;
    background: var(--gold);
  }
  .section-banner h2 {
    font-family: var(--font-display);
    font-size: 20px;
    letter-spacing: 2px;
    margin-bottom: 2px;
  }
  .section-banner .subtitle {
    color: var(--white-dim);
    font-size: 12px;
  }
  @media (min-width: 768px) {
    .section-banner { padding: 20px; border-radius: 12px; }
    .section-banner h2 { font-size: 22px; }
    .section-banner .subtitle { font-size: 13px; }
  }

  /* ===== LIVE BADGE ===== */
  .live-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: var(--red);
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  .live-dot {
    width: 5px;
    height: 5px;
    background: #fff;
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* ===== PROFILE SCREEN ===== */
  .profile-header {
    text-align: center;
    padding: 20px 0 16px;
  }

  .profile-avatar {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: var(--navy-mid);
    border: 3px solid var(--gold);
    margin: 0 auto 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-display);
    font-size: 28px;
    color: var(--gold);
  }
  @media (min-width: 768px) {
    .profile-avatar { width: 80px; height: 80px; font-size: 32px; }
  }

  .profile-name {
    font-family: var(--font-display);
    font-size: 24px;
    letter-spacing: 2px;
  }
  @media (min-width: 768px) { .profile-name { font-size: 28px; } }

  .profile-tier {
    font-size: 12px;
    color: var(--gold);
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  .stat-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin: 16px 0;
  }
  @media (min-width: 768px) { .stat-grid { gap: 12px; margin: 20px 0; } }

  .stat-box {
    background: var(--navy-light);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 10px;
    padding: 12px 8px;
    text-align: center;
  }

  .stat-value {
    font-family: var(--font-display);
    font-size: 22px;
    letter-spacing: 1px;
    color: var(--gold);
  }
  @media (min-width: 768px) { .stat-value { font-size: 26px; } }

  .stat-label {
    font-size: 10px;
    color: var(--white-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 2px;
  }

  .profile-link-list { margin-top: 16px; }

  .profile-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    min-height: 48px;
    background: var(--navy-light);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 10px;
    margin-bottom: 8px;
    cursor: pointer;
    text-decoration: none;
    color: var(--white);
    -webkit-tap-highlight-color: transparent;
  }
  .profile-link:active { background: var(--navy-mid); }
  @media (hover: hover) {
    .profile-link:hover { border-color: rgba(212,168,67,0.2); }
  }
  .profile-link .link-label { font-weight: 600; font-size: 14px; }
  .profile-link .link-arrow { color: var(--white-dim); }

  .profile-depth-bar {
    width: 100%;
    height: 6px;
    background: var(--navy);
    border-radius: 3px;
    margin-top: 12px;
    overflow: hidden;
  }
  .profile-depth-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--gold-dim), var(--gold));
    border-radius: 3px;
    transition: width 0.6s ease;
  }
  .profile-depth-text {
    font-size: 12px;
    color: var(--white-dim);
    margin-top: 4px;
    text-align: center;
  }

  /* ===== SHOP SCREEN ===== */
  .shop-section { margin-bottom: 20px; }

  .shop-section h3 {
    font-family: var(--font-display);
    font-size: 16px;
    letter-spacing: 2px;
    margin-bottom: 10px;
  }
  @media (min-width: 768px) { .shop-section h3 { font-size: 18px; } }

  .tier-card {
    background: var(--navy-light);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 10px;
  }
  .tier-card.popular { border-color: var(--gold-dim); }

  .tier-card h4 {
    font-family: var(--font-display);
    font-size: 18px;
    letter-spacing: 2px;
  }

  .tier-price {
    font-size: 22px;
    font-weight: 700;
    color: var(--gold);
    margin: 6px 0;
  }
  .tier-price span { font-size: 13px; color: var(--white-dim); font-weight: 400; }

  .tier-features { list-style: none; margin: 10px 0; }
  .tier-features li {
    padding: 3px 0;
    font-size: 14px;
    color: var(--white-dim);
  }
  .tier-features li::before { content: '‚öî '; color: var(--gold); }

  .subscribe-btn {
    width: 100%;
    min-height: var(--touch-min);
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-family: var(--font-display);
    font-size: 16px;
    letter-spacing: 2px;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  .subscribe-btn.primary { background: var(--red); color: #fff; }
  .subscribe-btn.primary:active { background: var(--red-hover); }
  .subscribe-btn.outline {
    background: transparent;
    color: var(--gold);
    border: 1px solid var(--gold-dim);
  }
  .subscribe-btn.outline:active { background: rgba(212,168,67,0.1); }
  @media (hover: hover) {
    .subscribe-btn.primary:hover { background: var(--red-hover); }
    .subscribe-btn.outline:hover { background: rgba(212,168,67,0.1); }
  }

  .token-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .token-pack {
    background: var(--navy-light);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 10px;
    padding: 16px 12px;
    text-align: center;
    cursor: pointer;
    min-height: 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
  }
  .token-pack:active { border-color: rgba(212,168,67,0.3); }
  @media (hover: hover) {
    .token-pack:hover { border-color: rgba(212,168,67,0.2); }
  }

  .token-amount {
    font-family: var(--font-display);
    font-size: 26px;
    color: var(--gold);
  }

  .token-price {
    font-size: 14px;
    font-weight: 600;
    margin-top: 4px;
  }

  /* ===== BOTTOM NAV (mobile-first, safe area) ===== */
  .bottom-nav {
    height: calc(var(--bottom-nav-height) + var(--safe-bottom));
    padding-bottom: var(--safe-bottom);
    background: var(--navy-light);
    border-top: 1px solid rgba(212,168,67,0.12);
    display: flex;
    align-items: center;
    justify-content: space-around;
    flex-shrink: 0;
    z-index: 100;
  }

  .bottom-nav-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1px;
    background: none;
    border: none;
    color: var(--white-dim);
    cursor: pointer;
    min-width: var(--touch-min);
    min-height: var(--touch-min);
    padding: 4px 8px;
    -webkit-tap-highlight-color: transparent;
  }
  .bottom-nav-btn:active { color: var(--white); }
  .bottom-nav-btn.active { color: var(--gold); }
  .bottom-nav-btn .nav-label {
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .bottom-nav-btn .nav-icon { font-size: 22px; }

  @media (min-width: 768px) {
    .bottom-nav-btn { min-width: 64px; padding: 6px 12px; }
    .bottom-nav-btn .nav-label { font-size: 10px; }
  }

  /* ===== LOADING ===== */
  .loading-screen {
    position: fixed;
    inset: 0;
    background: var(--navy);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
    z-index: 9999;
    transition: opacity 0.4s;
  }
  .loading-screen.fade-out { opacity: 0; pointer-events: none; }
  .loading-logo {
    font-family: var(--font-display);
    font-size: 32px;
    letter-spacing: 4px;
    color: var(--gold);
  }
  .loading-spinner {
    width: 28px; height: 28px;
    border: 3px solid var(--navy-mid);
    border-top-color: var(--gold);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* ===== USER DROPDOWN ===== */
  .user-dropdown {
    position: absolute;
    top: calc(var(--nav-height) + var(--safe-top) - 4px);
    right: max(8px, var(--safe-right));
    background: var(--navy-light);
    border: 1px solid rgba(212,168,67,0.2);
    border-radius: 10px;
    padding: 8px 0;
    min-width: 200px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    z-index: 200;
    display: none;
  }
  .user-dropdown.open { display: block; }

  .dropdown-item {
    display: flex;
    align-items: center;
    width: 100%;
    min-height: var(--touch-min);
    padding: 0 16px;
    background: none;
    border: none;
    color: var(--white);
    font-size: 15px;
    text-align: left;
    cursor: pointer;
    text-decoration: none;
    -webkit-tap-highlight-color: transparent;
  }
  .dropdown-item:active { background: var(--navy-mid); }
  @media (hover: hover) { .dropdown-item:hover { background: var(--navy-mid); } }
  .dropdown-item.danger { color: var(--red); }

  .dropdown-divider {
    height: 1px;
    background: rgba(255,255,255,0.06);
    margin: 4px 0;
  }

  /* ===== EMPTY STATE ===== */
  .empty-state {
    text-align: center;
    padding: 32px 16px;
    color: var(--white-dim);
  }
  .empty-state .empty-icon { font-size: 40px; margin-bottom: 10px; }
  .empty-state h3 {
    font-family: var(--font-display);
    font-size: 18px;
    letter-spacing: 2px;
    color: var(--white);
    margin-bottom: 8px;
  }

  /* ===== DESKTOP ENHANCEMENTS ===== */
  @media (min-width: 1100px) {
    .main-content { max-width: 100%; }
    /* Future: sidebar layout here */
  }

</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loading-screen" class="loading-screen">
  <div class="loading-logo">THE COLOSSEUM</div>
  <div class="loading-spinner"></div>
</div>

<!-- TOP NAV -->
<nav class="top-nav">
  <div class="logo">THE <span>COLOSSEUM</span></div>
  <div class="top-nav-right">
    <div class="token-bar" id="token-display">
      ü™ô <span id="token-count">0</span>
    </div>
    <button class="nav-icon-btn" id="notif-btn" title="Notifications">
      üîî
      <div class="notification-dot" id="notif-dot" style="display:none;"></div>
    </button>
    <div class="user-avatar-small" id="user-avatar-btn" title="Account">?</div>
  </div>
</nav>

<!-- USER DROPDOWN -->
<div class="user-dropdown" id="user-dropdown">
  <div style="padding:10px 16px; border-bottom:1px solid rgba(255,255,255,0.06);">
    <div style="font-weight:700;" id="dropdown-name">Gladiator</div>
    <div style="font-size:12px; color:var(--white-dim);" id="dropdown-tier">Free Tier</div>
  </div>
  <a href="colosseum-settings.html" class="dropdown-item">‚öôÔ∏è Settings</a>
  <a href="colosseum-profile-depth.html" class="dropdown-item">üìä Complete Profile</a>
  <div class="dropdown-divider"></div>
  <button class="dropdown-item danger" id="logout-btn">üö™ Log Out</button>
</div>

<!-- TICKER BAR -->
<div class="ticker-bar">
  <div class="ticker-label">üî¥ LIVE</div>
  <div class="ticker-scroll">
    <div class="ticker-content" id="ticker-content">
      <span>üî• "LeBron is NOT the GOAT" ‚Äî 847 reactions</span>
      <span>‚öîÔ∏è @gladiator42 challenged @ironmind ‚Äî Politics</span>
      <span>üìà TRENDING: "Should AI be regulated?" ‚Äî 2.1K watching</span>
      <span>üèÜ @sharpshooter won 5 straight ‚Äî ELO 1,847</span>
      <span>üî• "LeBron is NOT the GOAT" ‚Äî 847 reactions</span>
      <span>‚öîÔ∏è @gladiator42 challenged @ironmind ‚Äî Politics</span>
      <span>üìà TRENDING: "Should AI be regulated?" ‚Äî 2.1K watching</span>
      <span>üèÜ @sharpshooter won 5 straight ‚Äî ELO 1,847</span>
    </div>
  </div>
</div>

<!-- CATEGORY TABS -->
<div class="category-tabs">
  <button class="cat-tab active" data-cat="all">ALL</button>
  <button class="cat-tab" data-cat="politics">POLITICS</button>
  <button class="cat-tab" data-cat="sports">SPORTS</button>
  <button class="cat-tab" data-cat="entertainment">ENTERTAINMENT</button>
  <button class="cat-tab" data-cat="trending">üî• TRENDING</button>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">

  <!-- HOME SCREEN ‚Äî rendered by colosseum-home.js -->
  <div class="screen active" id="screen-home">
    <!-- ColosseumHome.render() fills this -->
  </div>

  <!-- ARENA SCREEN ‚Äî rendered by colosseum-arena.js -->
  <div class="screen" id="screen-arena">
    <!-- ColosseumArena.render() fills this -->
  </div>

  <!-- PROFILE SCREEN -->
  <div class="screen" id="screen-profile">
    <div class="profile-header">
      <div class="profile-avatar" id="profile-avatar">?</div>
      <div class="profile-name" id="profile-display-name">GLADIATOR</div>
      <div class="profile-tier" id="profile-tier">FREE TIER</div>

      <div class="profile-depth-bar">
        <div class="profile-depth-fill" id="profile-depth-fill" style="width:0%"></div>
      </div>
      <div class="profile-depth-text" id="profile-depth-text">Profile 0% complete ‚Äî <a href="colosseum-profile-depth.html" style="color:var(--gold);">unlock rewards</a></div>
    </div>

    <div class="stat-grid">
      <div class="stat-box">
        <div class="stat-value" id="stat-elo">1200</div>
        <div class="stat-label">ELO</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="stat-wins">0</div>
        <div class="stat-label">WINS</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="stat-losses">0</div>
        <div class="stat-label">LOSSES</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="stat-streak">0</div>
        <div class="stat-label">STREAK</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="stat-level">1</div>
        <div class="stat-label">LEVEL</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="stat-debates">0</div>
        <div class="stat-label">DEBATES</div>
      </div>
    </div>

    <div class="profile-link-list">
      <a href="colosseum-profile-depth.html" class="profile-link">
        <span class="link-label">üìä Complete Your Profile</span>
        <span class="link-arrow">‚Üí</span>
      </a>
      <a href="colosseum-settings.html" class="profile-link">
        <span class="link-label">‚öôÔ∏è Settings</span>
        <span class="link-arrow">‚Üí</span>
      </a>
      <div class="profile-link" onclick="navigateTo('shop')">
        <span class="link-label">üõí Cosmetics Shop</span>
        <span class="link-arrow">‚Üí</span>
      </div>
      <div class="profile-link" onclick="ColosseumShare?.shareProfile?.({userId:ColosseumAuth?.currentUser?.id,username:ColosseumAuth?.currentProfile?.username,displayName:ColosseumAuth?.currentProfile?.display_name,elo:ColosseumAuth?.currentProfile?.elo_rating,wins:ColosseumAuth?.currentProfile?.wins,losses:ColosseumAuth?.currentProfile?.losses,streak:ColosseumAuth?.currentProfile?.current_streak})">
        <span class="link-label">üîó Share Profile</span>
        <span class="link-arrow">‚Üí</span>
      </div>
      <div class="profile-link" onclick="ColosseumShare?.inviteFriend?.()">
        <span class="link-label">üì® Invite a Friend</span>
        <span class="link-arrow">‚Üí</span>
      </div>
    </div>
  </div>

  <!-- SHOP SCREEN -->
  <div class="screen" id="screen-shop">

    <div class="section-banner">
      <h2>üõí THE ARMORY</h2>
      <div class="subtitle">Gear up. Stand out. Dominate.</div>
    </div>

    <!-- Subscription Tiers -->
    <div class="shop-section">
      <h3>SUBSCRIPTION TIERS</h3>

      <div class="tier-card">
        <h4>‚öîÔ∏è CONTENDER</h4>
        <div class="tier-price">$9.99 <span>/mo</span></div>
        <ul class="tier-features">
          <li>Ad-free experience</li>
          <li>Custom profile themes</li>
          <li>30 tokens/day</li>
          <li>Priority matchmaking</li>
        </ul>
        <button class="subscribe-btn outline" onclick="ColosseumPayments?.subscribe?.('contender')">UPGRADE</button>
      </div>

      <div class="tier-card popular">
        <h4>üèÜ CHAMPION</h4>
        <div class="tier-price">$19.99 <span>/mo</span></div>
        <ul class="tier-features">
          <li>Everything in Contender</li>
          <li>Exclusive cosmetics</li>
          <li>Create private rooms</li>
          <li>Detailed analytics</li>
        </ul>
        <button class="subscribe-btn primary" onclick="ColosseumPayments?.subscribe?.('champion')">UPGRADE</button>
      </div>

      <div class="tier-card">
        <h4>üëë CREATOR</h4>
        <div class="tier-price">$29.99 <span>/mo</span></div>
        <ul class="tier-features">
          <li>Everything in Champion</li>
          <li>Creator tools & overlays</li>
          <li>Revenue share on bookings</li>
          <li>Early access to features</li>
        </ul>
        <button class="subscribe-btn outline" onclick="ColosseumPayments?.subscribe?.('creator')">UPGRADE</button>
      </div>
    </div>

    <!-- Token Packs -->
    <div class="shop-section">
      <h3>TOKEN PACKS</h3>
      <div class="token-grid">
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_50')">
          <div class="token-amount">50</div>
          <div class="token-price">$0.99</div>
        </div>
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_250')">
          <div class="token-amount">250</div>
          <div class="token-price">$3.99</div>
        </div>
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_600')">
          <div class="token-amount">600</div>
          <div class="token-price">$7.99</div>
        </div>
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_1800')">
          <div class="token-amount">1,800</div>
          <div class="token-price">$19.99</div>
        </div>
      </div>
    </div>
  </div>

  <!-- LEADERBOARD SCREEN -->
  <div class="screen" id="screen-leaderboard">
    <!-- Rendered by colosseum-leaderboard.js -->
  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="bottom-nav-btn active" data-screen="home">
    <span class="nav-icon">üè†</span>
    <span class="nav-label">Home</span>
  </button>
  <button class="bottom-nav-btn" data-screen="arena">
    <span class="nav-icon">‚öîÔ∏è</span>
    <span class="nav-label">Arena</span>
  </button>
  <button class="bottom-nav-btn" data-screen="shop">
    <span class="nav-icon">üõí</span>
    <span class="nav-label">Shop</span>
  </button>
  <button class="bottom-nav-btn" data-screen="leaderboard">
    <span class="nav-icon">üèÜ</span>
    <span class="nav-label">Ranks</span>
  </button>
  <button class="bottom-nav-btn" data-screen="profile">
    <span class="nav-icon">üë§</span>
    <span class="nav-label">Profile</span>
  </button>
</nav>

<script>
// ============================================================
// APP SHELL ‚Äî wires V2 modules into the main interface
// ============================================================

// --- Navigation (Item 14.6.1.4: continue where you left off) ---
function navigateTo(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.bottom-nav-btn').forEach(b => b.classList.remove('active'));

  const screen = document.getElementById('screen-' + screenId);
  if (screen) screen.classList.add('active');

  const btn = document.querySelector(`.bottom-nav-btn[data-screen="${screenId}"]`);
  if (btn) btn.classList.add('active');

  // Scroll to top on screen change
  document.querySelector('.main-content')?.scrollTo(0, 0);

  // Remember last screen
  try { localStorage.setItem('colosseum_last_screen', screenId); } catch(e) {}
}

document.querySelectorAll('.bottom-nav-btn').forEach(btn => {
  btn.addEventListener('click', () => navigateTo(btn.dataset.screen));
});

// --- Category Tabs ---
document.querySelectorAll('.cat-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    if (typeof ColosseumAsync !== 'undefined') {
      ColosseumAsync.loadHotTakes(tab.dataset.cat);
    }
  });
});

// --- User Dropdown ---
const avatarBtn = document.getElementById('user-avatar-btn');
const dropdown = document.getElementById('user-dropdown');

avatarBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  dropdown.classList.toggle('open');
});

document.addEventListener('click', () => {
  dropdown.classList.remove('open');
});

// --- Logout ---
document.getElementById('logout-btn').addEventListener('click', async () => {
  if (typeof ColosseumAuth !== 'undefined' && ColosseumAuth.logOut) await ColosseumAuth.logOut();
  window.location.href = 'colosseum-login.html';
});

// --- Auth State ‚Üí UI ---
function updateUIFromProfile(user, profile) {
  if (!profile) return;

  const initial = (profile.display_name || profile.username || '?')[0].toUpperCase();
  
  document.getElementById('user-avatar-btn').textContent = initial;
  document.getElementById('profile-avatar').textContent = initial;

  document.getElementById('profile-display-name').textContent = 
    (profile.display_name || profile.username || 'GLADIATOR').toUpperCase();
  
  const tierLabels = { free: 'FREE TIER', contender: 'CONTENDER', champion: 'CHAMPION', creator: 'CREATOR' };
  const tier = profile.subscription_tier || 'free';
  document.getElementById('profile-tier').textContent = tierLabels[tier] || 'FREE TIER';
  document.getElementById('dropdown-name').textContent = profile.display_name || profile.username || 'Gladiator';
  document.getElementById('dropdown-tier').textContent = tierLabels[tier] || 'Free Tier';

  document.getElementById('stat-elo').textContent = profile.elo_rating || 1200;
  document.getElementById('stat-wins').textContent = profile.wins || 0;
  document.getElementById('stat-losses').textContent = profile.losses || 0;
  document.getElementById('stat-streak').textContent = profile.current_streak || 0;
  document.getElementById('stat-level').textContent = profile.level || 1;
  document.getElementById('stat-debates').textContent = profile.debates_completed || 0;

  document.getElementById('token-count').textContent = profile.token_balance || 0;

  const depth = profile.profile_depth_pct || 0;
  document.getElementById('profile-depth-fill').style.width = depth + '%';
  document.getElementById('profile-depth-text').innerHTML = 
    `Profile ${depth}% complete ‚Äî <a href="colosseum-profile-depth.html" style="color:var(--gold);">unlock rewards</a>`;
}

if (typeof ColosseumAuth !== 'undefined') {
  ColosseumAuth.onChange(updateUIFromProfile);
}

// --- Init ---
window.addEventListener('DOMContentLoaded', () => {
  // Guard: if auth module didn't load, create placeholder
  if (typeof ColosseumAuth === 'undefined') {
    window.ColosseumAuth = { currentUser: null, currentProfile: null, isPlaceholderMode: true, listeners: [], onChange(){}, _notify(){} };
  }

  let authResolved = false;
  const maxWaitMs = 4000; // Don't wait forever for auth

  function onReady() {
    if (authResolved) return;
    authResolved = true;

    // Hide loading screen
    const loading = document.getElementById('loading-screen');
    if (loading) {
      loading.classList.add('fade-out');
      setTimeout(() => loading.remove(), 400);
    }

    // If NOT placeholder and no user, redirect to login
    if (!ColosseumAuth.isPlaceholderMode && !ColosseumAuth.currentUser) {
      window.location.href = 'colosseum-login.html';
      return;
    }

    // If placeholder mode, load demo data
    if (ColosseumAuth.isPlaceholderMode) {
      updateUIFromProfile(null, {
        display_name: 'Gladiator',
        username: 'gladiator',
        elo_rating: 1200,
        wins: 0,
        losses: 0,
        current_streak: 0,
        level: 1,
        debates_completed: 0,
        token_balance: 50,
        subscription_tier: 'free',
        profile_depth_pct: 0,
      });
    }

    // Restore last screen (Item 14.6.1.4)
    try {
      const urlScreen = new URLSearchParams(window.location.search).get('screen');
      const lastScreen = urlScreen || localStorage.getItem('colosseum_last_screen');
      if (lastScreen && document.getElementById('screen-' + lastScreen)) {
        navigateTo(lastScreen);
      }
    } catch(e) {}
  }

  // If placeholder mode, ready immediately (no async to wait on)
  if (ColosseumAuth.isPlaceholderMode) {
    setTimeout(onReady, 600);
    return;
  }

  // Listen for auth to resolve (fires immediately if already resolved, or on session load)
  ColosseumAuth.onChange((user, profile) => {
    if (user && profile) onReady();
  });

  // Safety timeout: if auth never resolves (network issue), still proceed
  setTimeout(() => {
    if (!authResolved) {
      console.warn('Auth did not resolve in time, proceeding...');
      onReady();
    }
  }, maxWaitMs);
});

// --- Payment success/cancel check ---
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('payment') === 'success') {
  const toast = document.createElement('div');
  toast.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:var(--success);color:#fff;padding:12px 24px;border-radius:8px;font-weight:700;z-index:9999;';
  toast.textContent = '‚úÖ Payment successful!';
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
  window.history.replaceState({}, '', window.location.pathname);
}

if (urlParams.get('payment') === 'canceled') {
  const toast = document.createElement('div');
  toast.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:var(--navy-mid);color:var(--white-dim);padding:12px 24px;border-radius:8px;font-weight:600;z-index:9999;border:1px solid rgba(255,255,255,0.1);';
  toast.textContent = 'Payment canceled.';
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
  window.history.replaceState({}, '', window.location.pathname);
}
</script>
</body>
</html>
