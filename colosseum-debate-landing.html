<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a1628">

<!-- ============================================================
     OPEN GRAPH META TAGS (Item 16.5.1)
     These are STATIC defaults. When you have a server-side
     renderer or Edge Function, replace these dynamically per topic.
     ============================================================ -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="The Colosseum">
<meta property="og:title" content="PASTE_DEBATE_TOPIC_HERE | The Colosseum">
<meta property="og:description" content="Cast your vote and settle this debate ‚Äî no signup required.">
<meta property="og:image" content="https://colosseum-six.vercel.app/og-card-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://colosseum-six.vercel.app/debate">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PASTE_DEBATE_TOPIC_HERE | The Colosseum">
<meta name="twitter:description" content="Cast your vote and settle this debate ‚Äî no signup required.">
<meta name="twitter:image" content="https://colosseum-six.vercel.app/og-card-default.png">

<title>The Colosseum ‚Äî Settle This</title>

<!-- Supabase CDN (optional ‚Äî works without it) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="colosseum-config.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Barlow+Condensed:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --navy: #0a1628;
    --navy-light: #132240;
    --navy-mid: #1a2d4a;
    --red: #cc2936;
    --red-hover: #e63946;
    --gold: #d4a843;
    --gold-dim: #b8922e;
    --white: #f0f0f0;
    --white-dim: #a0a8b8;
    --success: #2ecc71;
    --blue-side: #3b82f6;
    --red-side: #ef4444;
    --glass-bg: rgba(10,17,40,0.6);
    --glass-border: rgba(255,255,255,0.15);
    --glass-border-bright: rgba(255,255,255,0.3);
    --font-display: 'Cinzel', serif;
    --font-body: 'Barlow Condensed', sans-serif;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
  }

  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font-body);
    color: var(--white);
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: calc(20px + var(--safe-top)) 16px calc(20px + var(--safe-bottom));
    overflow-y: auto;
    -webkit-font-smoothing: antialiased;
    background: linear-gradient(135deg, #0a1628 0%, #1a2d4a 25%, #2d5a8e 50%, #5b8abf 75%, #3d5a80 100%);
    background-attachment: fixed;
  }

  /* === LIVE BADGE === */
  .live-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: var(--red);
    color: #fff;
    font-family: var(--font-body);
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding: 4px 12px;
    border-radius: 20px;
    margin-bottom: 12px;
    animation: pulse-badge 2s ease-in-out infinite;
  }
  .live-badge::before {
    content: '';
    width: 6px; height: 6px;
    background: #fff;
    border-radius: 50%;
    animation: blink 1.2s ease-in-out infinite;
  }
  @keyframes pulse-badge { 0%,100%{ opacity:1; } 50%{ opacity:.85; } }
  @keyframes blink { 0%,100%{ opacity:1; } 50%{ opacity:.3; } }

  /* === MAIN CARD === */
  .debate-card {
    width: 100%;
    max-width: 440px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border-bright);
    border-radius: 20px;
    padding: 28px 24px 24px;
    text-align: center;
    position: relative;
    overflow: hidden;
    animation: card-enter .6s cubic-bezier(.16,1,.3,1) both;
  }
  @keyframes card-enter { from { opacity:0; transform: translateY(24px) scale(.97); } }

  .debate-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--gold), var(--red), var(--gold));
  }

  /* === CATEGORY TAG === */
  .category-tag {
    display: inline-block;
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 8px;
  }

  /* === TOPIC === */
  .topic-text {
    font-family: var(--font-display);
    font-weight: 900;
    font-size: clamp(22px, 6vw, 32px);
    line-height: 1.15;
    color: #fff;
    margin-bottom: 20px;
    text-shadow: 0 2px 8px rgba(0,0,0,.4);
  }

  /* === VOTE BAR === */
  .vote-bar-container {
    width: 100%;
    margin-bottom: 20px;
  }
  .vote-bar-labels {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-family: var(--font-body);
    font-weight: 700;
    font-size: 14px;
  }
  .vote-bar-labels .yes-label { color: var(--blue-side); }
  .vote-bar-labels .no-label { color: var(--red-side); }
  .vote-bar-track {
    width: 100%;
    height: 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    overflow: hidden;
    display: flex;
  }
  .vote-bar-fill-yes {
    height: 100%;
    background: linear-gradient(90deg, #2563eb, #3b82f6);
    border-radius: 10px 0 0 10px;
    transition: width 1s cubic-bezier(.16,1,.3,1);
    width: 0%;
  }
  .vote-bar-fill-no {
    height: 100%;
    background: linear-gradient(90deg, #ef4444, #dc2626);
    border-radius: 0 10px 10px 0;
    transition: width 1s cubic-bezier(.16,1,.3,1);
    width: 0%;
  }
  .vote-count {
    text-align: center;
    font-family: var(--font-body);
    font-weight: 500;
    font-size: 13px;
    color: var(--white-dim);
    margin-top: 6px;
  }

  /* === VOTE BUTTONS === */
  .vote-buttons {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
  }
  .vote-btn {
    flex: 1;
    padding: 16px 12px;
    border: 2px solid;
    border-radius: 14px;
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 18px;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all .2s ease;
    -webkit-tap-highlight-color: transparent;
    min-height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .vote-btn:active { transform: scale(.96); }
  .vote-btn.yes-btn {
    background: rgba(37,99,235,0.15);
    border-color: var(--blue-side);
    color: var(--blue-side);
  }
  .vote-btn.yes-btn:hover { background: rgba(37,99,235,0.3); }
  .vote-btn.no-btn {
    background: rgba(239,68,68,0.15);
    border-color: var(--red-side);
    color: var(--red-side);
  }
  .vote-btn.no-btn:hover { background: rgba(239,68,68,0.3); }
  .vote-btn.voted {
    opacity: .5;
    pointer-events: none;
    transform: scale(.95);
  }
  .vote-btn.selected {
    opacity: 1;
    transform: scale(1);
    box-shadow: 0 0 20px rgba(255,255,255,.15);
  }
  .vote-btn.selected.yes-btn { background: var(--blue-side); color: #fff; }
  .vote-btn.selected.no-btn { background: var(--red-side); color: #fff; }

  /* === RESULTS (hidden until voted) === */
  .results-section {
    display: none;
    animation: reveal .5s cubic-bezier(.16,1,.3,1) both;
  }
  .results-section.visible { display: block; }
  @keyframes reveal { from { opacity: 0; transform: translateY(12px); } }

  .result-check {
    font-size: 13px;
    color: var(--success);
    font-weight: 600;
    margin-bottom: 12px;
  }

  /* === HOT TAKES PREVIEW === */
  .hot-takes-section {
    margin-top: 16px;
    text-align: left;
  }
  .hot-takes-title {
    font-family: var(--font-display);
    font-size: 14px;
    letter-spacing: 1px;
    color: var(--gold);
    margin-bottom: 10px;
    text-transform: uppercase;
  }
  .hot-take-item {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    padding: 10px 14px;
    margin-bottom: 8px;
    font-size: 14px;
    line-height: 1.4;
    color: var(--white-dim);
  }
  .hot-take-item strong {
    color: var(--white);
    font-weight: 600;
  }
  .hot-take-item .take-reactions {
    display: flex;
    gap: 12px;
    margin-top: 6px;
    font-size: 12px;
    color: rgba(255,255,255,.4);
  }

  /* === CTA SECTION === */
  .cta-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
  }
  .cta-text {
    font-family: var(--font-body);
    font-weight: 500;
    font-size: 15px;
    color: var(--white-dim);
    margin-bottom: 14px;
  }
  .cta-text strong { color: #fff; }
  .cta-btn {
    display: block;
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--gold-dim), var(--gold));
    color: var(--navy);
    border: none;
    border-radius: 14px;
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 17px;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all .2s ease;
    text-decoration: none;
    text-align: center;
    min-height: 52px;
  }
  .cta-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(212,168,67,.3); }
  .cta-btn:active { transform: scale(.98); }

  .cta-oauth {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }
  .cta-oauth-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    border-radius: 12px;
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    border: 1px solid rgba(255,255,255,.15);
    min-height: 48px;
    transition: all .2s;
    text-decoration: none;
  }
  .cta-oauth-btn:active { transform: scale(.97); }
  .cta-oauth-google { background: #fff; color: #333; }
  .cta-oauth-google:hover { background: #f5f5f5; }
  .cta-oauth-apple { background: #000; color: #fff; }
  .cta-oauth-apple:hover { background: #222; }

  .or-divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 12px 0;
    font-size: 12px;
    color: rgba(255,255,255,.3);
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .or-divider::before, .or-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(255,255,255,.1);
  }

  /* === WATERMARK (Item 16.5.2) === */
  .watermark {
    margin-top: 20px;
    text-align: center;
    font-family: var(--font-body);
    font-size: 12px;
    color: rgba(255,255,255,.25);
    letter-spacing: .5px;
  }
  .watermark a {
    color: rgba(212,168,67,.5);
    text-decoration: none;
  }
  .watermark a:hover { color: var(--gold); }

  /* === SHARE BAR === */
  .share-bar {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 14px;
  }
  .share-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 10px;
    background: rgba(255,255,255,.08);
    border: 1px solid rgba(255,255,255,.1);
    color: var(--white-dim);
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all .2s;
    -webkit-tap-highlight-color: transparent;
  }
  .share-btn:hover { background: rgba(255,255,255,.14); color: #fff; }
  .share-btn:active { transform: scale(.95); }

  /* === CONFETTI === */
  .confetti-particle {
    position: fixed;
    width: 8px;
    height: 8px;
    border-radius: 2px;
    pointer-events: none;
    z-index: 999;
    animation: confetti-fall 1.5s cubic-bezier(.25,.46,.45,.94) forwards;
  }
  @keyframes confetti-fall {
    0% { opacity: 1; transform: translateY(0) rotate(0deg) scale(1); }
    100% { opacity: 0; transform: translateY(60vh) rotate(720deg) scale(.3); }
  }

  /* === TOAST === */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: rgba(10,17,40,.95);
    border: 1px solid var(--glass-border-bright);
    backdrop-filter: blur(12px);
    padding: 12px 24px;
    border-radius: 12px;
    font-family: var(--font-body);
    font-size: 14px;
    color: #fff;
    z-index: 1000;
    transition: transform .3s cubic-bezier(.16,1,.3,1);
    pointer-events: none;
  }
  .toast.visible { transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<div class="debate-card">
  <!-- Live indicator -->
  <div class="live-badge">LIVE DEBATE</div>

  <!-- Category -->
  <div class="category-tag" id="categoryTag">SPORTS</div>

  <!-- Topic -->
  <h1 class="topic-text" id="topicText">Loading debate...</h1>

  <!-- Vote Bar (visible always, updates after vote) -->
  <div class="vote-bar-container">
    <div class="vote-bar-labels">
      <span class="yes-label" id="yesLabel">YES <span id="yesPct">‚Äî</span></span>
      <span class="no-label" id="noLabel">NO <span id="noPct">‚Äî</span></span>
    </div>
    <div class="vote-bar-track">
      <div class="vote-bar-fill-yes" id="yesBar"></div>
      <div class="vote-bar-fill-no" id="noBar"></div>
    </div>
    <div class="vote-count" id="voteCount"></div>
  </div>

  <!-- Vote Buttons (hidden after vote) -->
  <div class="vote-buttons" id="voteButtons">
    <button class="vote-btn yes-btn" onclick="castVote('yes')">‚öîÔ∏è YES</button>
    <button class="vote-btn no-btn" onclick="castVote('no')">üõ°Ô∏è NO</button>
  </div>

  <!-- Results (shown after vote) -->
  <div class="results-section" id="resultsSection">
    <div class="result-check">‚úì Vote recorded</div>

    <!-- Share bar -->
    <div class="share-bar">
      <button class="share-btn" onclick="shareDebate('copy')">üìã Copy Link</button>
      <button class="share-btn" onclick="shareDebate('x')">ùïè Share</button>
      <button class="share-btn" onclick="shareDebate('native')">‚Üó Share</button>
    </div>

    <!-- Hot Takes preview -->
    <div class="hot-takes-section" id="hotTakesSection">
      <div class="hot-takes-title">üî• Hot Takes</div>
      <div id="hotTakesList"></div>
    </div>

    <!-- CTA -->
    <div class="cta-section">
      <p class="cta-text">Think you can <strong>defend your position</strong>?</p>
      <div class="cta-oauth">
        <a class="cta-oauth-btn cta-oauth-google" href="colosseum-login.html">
          <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18A10.96 10.96 0 001 12c0 1.78.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
          Google
        </a>
        <a class="cta-oauth-btn cta-oauth-apple" href="colosseum-login.html">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/></svg>
          Apple
        </a>
      </div>
      <div class="or-divider">or</div>
      <a class="cta-btn" href="colosseum-login.html">‚öîÔ∏è Enter The Arena</a>
    </div>
  </div>
</div>

<!-- Watermark (Item 16.5.2) -->
<div class="watermark">
  ‚öîÔ∏è Powered by <a href="https://colosseum-six.vercel.app">The Colosseum</a> ‚Äî Where opinions fight.
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ============================================================
// UNGATED DEBATE LANDING PAGE (Item 16.5.4)
// No signup required to vote. Gate only on debate participation.
// URL format: /debate?topic=slug&cat=sports&id=xxx
// ============================================================

const DEMO_DEBATES = [
  { slug: 'mahomes-vs-allen', topic: 'Is Patrick Mahomes better than Josh Allen?', category: 'SPORTS', yesVotes: 1847, noVotes: 1392, takes: [
    { user: 'GridironGuru', text: 'Three rings vs. zero. End of discussion.', fire: 42, reply: 18 },
    { user: 'BillsMafia716', text: 'Allen has better stats per game this season. Rings are a team stat.', fire: 38, reply: 24 },
    { user: 'NFLAnalytics', text: 'Mahomes has more comebacks from 10+ point deficits than anyone in playoff history.', fire: 31, reply: 12 },
  ]},
  { slug: 'caleb-downs-top10', topic: 'Is Caleb Downs worth a top 10 pick?', category: 'SPORTS', yesVotes: 923, noVotes: 1105, takes: [
    { user: 'DraftKings2026', text: 'Best safety prospect since Ed Reed. You take that every time.', fire: 56, reply: 22 },
    { user: 'ScoutingReport', text: 'Safeties don\'t go top 10 for a reason. Value isn\'t there.', fire: 44, reply: 31 },
  ]},
  { slug: 'trump-tariffs', topic: 'Will Trump\'s tariffs help the American economy?', category: 'POLITICS', yesVotes: 2103, noVotes: 3240, takes: [
    { user: 'EconWatch', text: 'Short-term pain, but domestic manufacturing needs protection.', fire: 67, reply: 45 },
    { user: 'FreeTrader', text: 'Every economist agrees tariffs raise consumer prices. This isn\'t debatable.', fire: 89, reply: 52 },
  ]},
  { slug: 'beyonce-greatest', topic: 'Is Beyonc√© the greatest performer of all time?', category: 'ENTERTAINMENT', yesVotes: 4102, noVotes: 2876, takes: [
    { user: 'MusicHead', text: 'MJ exists. Prince exists. Freddie Mercury exists. Come on.', fire: 72, reply: 38 },
    { user: 'BeyHive', text: 'Name someone who can sing, dance, act, and direct at that level. We\'ll wait.', fire: 95, reply: 41 },
  ]},
];

let state = {
  debate: null,
  voted: false,
  votedSide: null,
  yesVotes: 0,
  noVotes: 0,
};

// Parse URL params
function getParams() {
  const p = new URLSearchParams(window.location.search);
  return {
    topic: p.get('topic') || p.get('t'),
    id: p.get('id'),
    cat: p.get('cat'),
    side: p.get('side'),
  };
}

// Find or create debate
function loadDebate() {
  const params = getParams();
  let debate = null;

  // Try to find by slug
  if (params.topic) {
    debate = DEMO_DEBATES.find(d => d.slug === params.topic);
  }

  // Try by ID (for Supabase-backed debates later)
  if (!debate && params.id) {
    // PLACEHOLDER: fetch from Supabase when real debates exist
    // For now fall back to demo
  }

  // Default to first demo debate
  if (!debate) {
    debate = DEMO_DEBATES[Math.floor(Math.random() * DEMO_DEBATES.length)];
  }

  state.debate = debate;
  state.yesVotes = debate.yesVotes;
  state.noVotes = debate.noVotes;

  // Check if already voted (localStorage)
  const voteKey = 'colosseum_vote_' + debate.slug;
  const existing = localStorage.getItem(voteKey);
  if (existing) {
    state.voted = true;
    state.votedSide = existing;
  }

  renderDebate();

  // If URL has side param, auto-scroll to vote section
  if (params.side && !state.voted) {
    // Highlight the suggested side
    setTimeout(() => {
      const btn = document.querySelector(params.side === 'yes' ? '.yes-btn' : '.no-btn');
      if (btn) btn.style.boxShadow = '0 0 20px rgba(255,255,255,.2)';
    }, 800);
  }

  // Update OG tags dynamically (for JS-rendered crawlers)
  updateMetaTags(debate);
}

function updateMetaTags(debate) {
  const total = state.yesVotes + state.noVotes;
  const yesPct = total > 0 ? Math.round((state.yesVotes / total) * 100) : 50;

  document.title = debate.topic + ' | The Colosseum';

  const setMeta = (prop, val) => {
    let el = document.querySelector(`meta[property="${prop}"]`) || document.querySelector(`meta[name="${prop}"]`);
    if (el) el.setAttribute('content', val);
  };
  setMeta('og:title', debate.topic + ' | The Colosseum');
  setMeta('og:description', yesPct + '% say YES ‚Äî Cast your vote and settle this debate');
  setMeta('og:url', window.location.href);
  setMeta('twitter:title', debate.topic + ' | The Colosseum');
  setMeta('twitter:description', yesPct + '% say YES ‚Äî Cast your vote and settle this debate');
}

function renderDebate() {
  const d = state.debate;
  document.getElementById('categoryTag').textContent = d.category;
  document.getElementById('topicText').textContent = d.topic;

  updateVoteBar();

  if (state.voted) {
    showResults();
  }

  renderHotTakes(d.takes || []);
}

function updateVoteBar() {
  const total = state.yesVotes + state.noVotes;
  const yesPct = total > 0 ? Math.round((state.yesVotes / total) * 100) : 50;
  const noPct = 100 - yesPct;

  document.getElementById('yesPct').textContent = yesPct + '%';
  document.getElementById('noPct').textContent = noPct + '%';
  document.getElementById('voteCount').textContent = total.toLocaleString() + ' votes';

  // Animate bars
  setTimeout(() => {
    document.getElementById('yesBar').style.width = yesPct + '%';
    document.getElementById('noBar').style.width = noPct + '%';
  }, 200);
}

function castVote(side) {
  if (state.voted) return;

  state.voted = true;
  state.votedSide = side;

  // Update counts
  if (side === 'yes') state.yesVotes++;
  else state.noVotes++;

  // Store in localStorage
  const voteKey = 'colosseum_vote_' + state.debate.slug;
  localStorage.setItem(voteKey, side);

  // Visual feedback on buttons
  const buttons = document.querySelectorAll('.vote-btn');
  buttons.forEach(btn => {
    btn.classList.add('voted');
    if ((side === 'yes' && btn.classList.contains('yes-btn')) ||
        (side === 'no' && btn.classList.contains('no-btn'))) {
      btn.classList.add('selected');
      btn.classList.remove('voted');
    }
  });

  // Haptic feedback
  if (navigator.vibrate) navigator.vibrate(30);

  // Confetti burst
  spawnConfetti(side === 'yes' ? '#3b82f6' : '#ef4444');

  // Update bar
  updateVoteBar();

  // Show results after short delay
  setTimeout(showResults, 600);

  // PLACEHOLDER: Write vote to Supabase when real debates exist
  // try {
  //   const supabase = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  //   if (supabase) {
  //     await supabase.from('debate_votes').insert({ debate_id: state.debate.id, side, fingerprint: getFingerprint() });
  //   }
  // } catch(e) {}
}

function showResults() {
  const section = document.getElementById('resultsSection');
  section.classList.add('visible');

  // Hide vote buttons after a beat
  setTimeout(() => {
    document.getElementById('voteButtons').style.display = 'none';
  }, 200);
}

function renderHotTakes(takes) {
  const list = document.getElementById('hotTakesList');
  list.innerHTML = '';
  takes.forEach(t => {
    const el = document.createElement('div');
    el.className = 'hot-take-item';
    el.innerHTML = `
      <strong>@${t.user}</strong> ‚Äî ${t.text}
      <div class="take-reactions">
        <span>üî• ${t.fire}</span>
        <span>üí¨ ${t.reply}</span>
      </div>
    `;
    list.appendChild(el);
  });
}

// Share functionality
function shareDebate(method) {
  const d = state.debate;
  const total = state.yesVotes + state.noVotes;
  const yesPct = total > 0 ? Math.round((state.yesVotes / total) * 100) : 50;
  const url = window.location.origin + '/debate?topic=' + d.slug;
  const text = `${d.topic}\n\n${yesPct}% say YES ‚Äî Cast your vote ‚öîÔ∏è`;

  if (method === 'native' && navigator.share) {
    navigator.share({ title: d.topic + ' | The Colosseum', text, url }).catch(() => {});
  } else if (method === 'x') {
    window.open('https://x.com/intent/tweet?text=' + encodeURIComponent(text + '\n' + url), '_blank');
  } else {
    navigator.clipboard.writeText(url).then(() => showToast('Link copied!')).catch(() => {});
  }
}

// Confetti
function spawnConfetti(color) {
  const colors = [color, '#d4a843', '#fff', color];
  for (let i = 0; i < 20; i++) {
    const el = document.createElement('div');
    el.className = 'confetti-particle';
    el.style.background = colors[Math.floor(Math.random() * colors.length)];
    el.style.left = (30 + Math.random() * 40) + 'vw';
    el.style.top = (20 + Math.random() * 20) + 'vh';
    el.style.animationDelay = (Math.random() * .3) + 's';
    el.style.animationDuration = (1 + Math.random() * 1) + 's';
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 2500);
  }
}

// Toast
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('visible');
  setTimeout(() => t.classList.remove('visible'), 2000);
}

// Init
document.addEventListener('DOMContentLoaded', loadDebate);
</script>

</body>
</html>
