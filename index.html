<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a1128">
<title>The Colosseum</title>

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Stripe CDN -->
<script src="https://js.stripe.com/v3/"></script>

<!-- V2 Modules -->
<script src="colosseum-config.js"></script>
<script src="colosseum-auth.js"></script>
<script src="colosseum-payments.js"></script>
<script src="colosseum-notifications.js"></script>
<script src="colosseum-paywall.js"></script>
<script src="colosseum-async.js"></script>
<script src="colosseum-share.js"></script>
<script src="colosseum-leaderboard.js"></script>
<script src="colosseum-scoring.js"></script>
<script src="colosseum-webrtc.js"></script>
<script src="colosseum-voicememo.js"></script>
<script src="colosseum-home.js"></script>
<script src="colosseum-arena.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;900&family=Barlow+Condensed:wght@400;600;700&display=swap');

  /* ============================================================
     NEW AGE MOBILE-FIRST CSS ‚Äî Spoke Carousel + Glassmorphism
     Decision 3.2: phone is default
     ============================================================ */

  :root {
    --navy: #0a1128;
    --navy-light: #132240;
    --navy-mid: #1a2d4a;
    --red: #c1272d;
    --red-hover: #e63946;
    --gold: #d4a843;
    --gold-glow: #e8c460;
    --gold-dim: #b8922e;
    --white: #f0ece2;
    --white-dim: #a0a8b8;
    --success: #2ecc71;
    --error: #e74c3c;
    --font-display: 'Cinzel', serif;
    --font-body: 'Barlow Condensed', sans-serif;

    --glass-bg: rgba(10, 17, 40, 0.55);
    --glass-border: rgba(255, 255, 255, 0.25);
    --glass-heavy: rgba(10, 17, 40, 0.7);

    --nav-height: 52px;
    --bottom-nav-height: 56px;
    --touch-min: 44px;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);
    --tile-size: min(38vw, 155px);
  }

  @media (min-width: 768px) { :root { --nav-height: 56px; --bottom-nav-height: 64px; } }
  @media (min-width: 1100px) { :root { --nav-height: 60px; } }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; overflow: hidden; }

  body {
    font-family: var(--font-body);
    background: var(--navy);
    color: var(--white);
    display: flex;
    flex-direction: column;
    -webkit-tap-highlight-color: transparent;
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
  }

  /* === AMBIENT BACKGROUND === */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background: linear-gradient(145deg, #1a2d4a 0%, #2d5a8e 25%, #5b8abf 50%, #7aa3d4 75%, #3d5a80 100%);
    z-index: -2;
  }
  body::after {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse at 25% 20%, rgba(255,255,255,0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 75% 80%, rgba(212,168,67,0.06) 0%, transparent 45%);
    z-index: -1;
  }

  /* === TOP NAV (glassmorphic float) === */
  .top-nav {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    height: calc(var(--nav-height) + var(--safe-top));
    padding-top: var(--safe-top);
    padding-left: max(16px, var(--safe-left));
    padding-right: max(16px, var(--safe-right));
    display: flex; align-items: center; justify-content: space-between;
    background: linear-gradient(180deg, rgba(26,45,74,0.9) 0%, rgba(26,45,74,0.4) 70%, transparent 100%);
    flex-shrink: 0;
  }

  .top-nav .logo {
    font-family: var(--font-display);
    font-weight: 900;
    font-size: 18px;
    letter-spacing: 3px;
    color: var(--gold);
    text-shadow: 0 0 20px rgba(212,168,67,0.3);
  }
  @media (min-width: 768px) { .top-nav .logo { font-size: 22px; letter-spacing: 4px; } }

  .top-nav-right { display: flex; align-items: center; gap: 8px; }

  .nav-icon-btn {
    width: var(--touch-min); height: var(--touch-min);
    border-radius: 50%; border: none;
    background: var(--glass-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    color: var(--white-dim); font-size: 18px;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    position: relative;
  }
  .nav-icon-btn:active { background: var(--glass-heavy); color: var(--white); }

  .notification-dot {
    position: absolute; top: 8px; right: 8px;
    width: 8px; height: 8px; background: var(--red); border-radius: 50%;
  }

  .user-avatar-small {
    width: var(--touch-min); height: var(--touch-min);
    border-radius: 50%;
    border: 2px solid var(--gold-dim);
    background: var(--glass-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    color: var(--gold);
    font-family: var(--font-display); font-weight: 700; font-size: 18px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
  }
  .user-avatar-small:active { border-color: var(--gold); }

  .token-bar {
    display: flex; align-items: center; gap: 4px;
    background: var(--glass-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(212,168,67,0.15);
    padding: 6px 10px; border-radius: 20px;
    font-size: 12px; font-weight: 600; color: var(--gold); min-height: 32px;
  }

  /* === LIVE STRIP === */
  .live-strip {
    position: fixed; top: calc(var(--safe-top) + var(--nav-height));
    left: 0; right: 0; z-index: 90;
    padding: 4px 16px;
    display: flex; align-items: center; gap: 8px;
    font-size: 11px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase; color: var(--gold); opacity: 0.7;
  }
  .live-strip .live-dot {
    width: 6px; height: 6px; background: var(--red); border-radius: 50%;
    animation: livePulse 1.5s ease-in-out infinite; flex-shrink: 0;
  }
  @keyframes livePulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }

  /* === USER DROPDOWN === */
  .user-dropdown {
    position: fixed;
    top: calc(var(--nav-height) + var(--safe-top) + 4px);
    right: max(8px, var(--safe-right));
    background: rgba(10, 17, 40, 0.85);
    backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
    border: 1.5px solid rgba(255, 255, 255, 0.25);
    border-radius: 16px; padding: 8px 0;
    min-width: 200px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    z-index: 200; display: none;
  }
  .user-dropdown.open { display: block; }

  .dropdown-item {
    display: flex; align-items: center; width: 100%;
    min-height: var(--touch-min); padding: 0 16px;
    background: none; border: none; color: var(--white);
    font-family: var(--font-body); font-size: 15px;
    text-align: left; cursor: pointer; text-decoration: none;
  }
  .dropdown-item:active { background: rgba(255,255,255,0.05); }
  .dropdown-item.danger { color: var(--red); }
  .dropdown-divider { height: 1px; background: var(--glass-border); margin: 4px 0; }

  /* === MAIN CONTENT AREA === */
  .main-content {
    position: fixed; inset: 0; z-index: 1;
    overflow-y: auto; overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    /* Pad for top nav + bottom nav */
    padding-top: calc(var(--safe-top) + var(--nav-height) + 24px);
    padding-bottom: calc(var(--safe-bottom) + var(--bottom-nav-height) + 16px);
  }

  .screen { display: none; padding: 12px 16px 20px; }
  .screen.active { display: block; }
  @media (min-width: 768px) { .screen { padding: 16px 20px; } }
  @media (min-width: 1100px) { .screen { max-width: 800px; margin: 0 auto; } }

  /* === HOME SCREEN ‚Äî SPOKE CAROUSEL === */
  #screen-home {
    padding: 0 !important;
    position: relative;
    height: calc(100vh - var(--safe-top) - var(--nav-height) - var(--safe-bottom) - var(--bottom-nav-height) - 40px);
    display: flex; align-items: center; justify-content: center;
  }
  #screen-home.active { display: flex; }

  .carousel-stage {
    width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center;
    perspective: 900px;
    touch-action: none;
  }

  .carousel-ring {
    position: relative; width: 0; height: 0;
    transform-style: preserve-3d;
    transform: rotateX(-18deg);
  }

  .cat-tile {
    position: absolute;
    width: var(--tile-size); height: var(--tile-size);
    margin-left: calc(var(--tile-size) / -2);
    margin-top: calc(var(--tile-size) / -2);
    border-radius: 20px; cursor: pointer;
    transform-style: preserve-3d;
    background: var(--glass-bg);
    backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    border: 1px solid var(--glass-border);
    box-shadow: 0 0 0 1px rgba(0,0,0,0.3), 0 8px 32px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.1);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 8px; padding: 12px;
    transition: box-shadow 0.3s, border-color 0.3s;
  }
  .cat-tile:active { border-color: var(--gold); box-shadow: 0 4px 20px rgba(212,168,67,0.25); }
  .cat-tile.hot { border-color: rgba(193,39,45,0.6); box-shadow: 0 0 0 1px rgba(0,0,0,0.3), 0 8px 32px rgba(193,39,45,0.2), inset 0 1px 0 rgba(255,255,255,0.1); }
  .cat-tile.hot::before { content: 'LIVE'; position: absolute; top: 8px; right: 10px; font-size: 9px; font-weight: 700; letter-spacing: 1.5px; color: var(--red); text-shadow: 0 0 8px rgba(193,39,45,0.5); }

  .tile-icon { font-size: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
  .tile-label { font-family: var(--font-display); font-weight: 700; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; text-align: center; color: var(--white); text-shadow: 0 1px 3px rgba(0,0,0,0.5); line-height: 1.3; }
  .tile-count { font-size: 10px; font-weight: 600; color: var(--gold); opacity: 0.7; }

  /* === HOT TAKE FAB === */
  .hot-take-fab {
    position: fixed;
    bottom: calc(var(--safe-bottom) + var(--bottom-nav-height) + 12px);
    right: 20px; z-index: 99;
    width: 52px; height: 52px; border-radius: 50%;
    background: linear-gradient(135deg, var(--gold) 0%, var(--gold-glow) 100%);
    border: none; color: var(--navy); font-size: 24px; font-weight: 900;
    cursor: pointer; box-shadow: 0 4px 24px rgba(212,168,67,0.4), 0 0 0 1px rgba(0,0,0,0.15);
    display: flex; align-items: center; justify-content: center;
  }
  .hot-take-fab:active { transform: scale(0.9); }

  /* === CATEGORY EXPAND OVERLAY === */
  .category-expand {
    position: fixed; inset: 0; z-index: 200;
    background: rgba(26,45,74,0.95);
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    display: none; flex-direction: column;
    padding: calc(var(--safe-top) + 16px) 16px calc(var(--safe-bottom) + 16px);
    overflow-y: auto; -webkit-overflow-scrolling: touch;
  }
  .category-expand.open { display: flex; }
  .expand-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 0 20px; }
  .expand-title { font-family: var(--font-display); font-weight: 900; font-size: 22px; letter-spacing: 2px; color: var(--gold); }
  .expand-close { background: none; border: none; color: var(--white); font-size: 28px; cursor: pointer; padding: 8px; opacity: 0.6; }
  .expand-close:active { opacity: 1; }

  .expand-content-card {
    background: var(--glass-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 16px; padding: 16px; margin-bottom: 12px;
  }
  .expand-card-type { font-size: 10px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: var(--gold); margin-bottom: 6px; }
  .expand-card-title { font-family: var(--font-display); font-size: 16px; font-weight: 700; margin-bottom: 4px; }
  .expand-card-meta { font-size: 12px; opacity: 0.5; }
  .expand-card-action {
    margin-top: 12px;
    background: rgba(212,168,67,0.15); border: 1px solid rgba(212,168,67,0.3);
    border-radius: 10px; padding: 10px 16px;
    color: var(--gold); font-family: var(--font-body);
    font-size: 13px; font-weight: 700; letter-spacing: 1px;
    text-transform: uppercase; text-align: center; cursor: pointer;
  }
  .expand-card-action:active { background: rgba(212,168,67,0.25); }
  .expand-card-action.live { background: rgba(193,39,45,0.15); border-color: rgba(193,39,45,0.4); color: var(--red); }
  .placeholder-tag { display: inline-block; font-size: 8px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; background: rgba(193,39,45,0.2); color: var(--red); padding: 2px 6px; border-radius: 4px; margin-left: 6px; }

  /* === GLASS SECTION BANNER (all sub-screens) === */
  .section-banner {
    background: var(--glass-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 16px; padding: 16px; margin-bottom: 12px;
    position: relative; overflow: hidden;
  }
  .section-banner::before {
    content: ''; position: absolute; top: 0; left: 0;
    width: 4px; height: 100%; background: var(--gold);
  }
  .section-banner h2 { font-family: var(--font-display); font-size: 20px; letter-spacing: 2px; margin-bottom: 2px; }
  .section-banner .subtitle { color: var(--white-dim); font-size: 12px; }

  /* === PROFILE SCREEN === */
  .profile-header { text-align: center; padding: 20px 0 16px; }
  .profile-avatar {
    width: 72px; height: 72px; border-radius: 50%;
    background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 3px solid var(--gold); margin: 0 auto 10px;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--font-display); font-size: 28px; color: var(--gold);
  }
  .profile-name { font-family: var(--font-display); font-size: 24px; letter-spacing: 2px; }
  .profile-tier { font-size: 12px; color: var(--gold); font-weight: 600; letter-spacing: 1px; text-transform: uppercase; margin-top: 4px; }

  .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 16px 0; }
  .stat-box {
    background: var(--glass-bg);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 14px; padding: 12px 8px; text-align: center;
  }
  .stat-value { font-family: var(--font-display); font-size: 22px; letter-spacing: 1px; color: var(--gold); }
  .stat-label { font-size: 10px; color: var(--white-dim); text-transform: uppercase; letter-spacing: 1px; margin-top: 2px; }

  .profile-link-list { margin-top: 16px; }
  .profile-link {
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 16px; min-height: 48px;
    background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 14px; margin-bottom: 8px;
    cursor: pointer; text-decoration: none; color: var(--white);
  }
  .profile-link:active { background: var(--glass-heavy); }
  .profile-link .link-label { font-weight: 600; font-size: 14px; }
  .profile-link .link-arrow { color: var(--white-dim); }

  .profile-depth-bar { width: 100%; height: 6px; background: rgba(255,255,255,0.06); border-radius: 3px; margin-top: 12px; overflow: hidden; }
  .profile-depth-fill { height: 100%; background: linear-gradient(90deg, var(--gold-dim), var(--gold)); border-radius: 3px; transition: width 0.6s ease; }
  .profile-depth-text { font-size: 12px; color: var(--white-dim); margin-top: 4px; text-align: center; }

  /* === SHOP SCREEN === */
  .shop-section { margin-bottom: 20px; }
  .shop-section h3 { font-family: var(--font-display); font-size: 16px; letter-spacing: 2px; margin-bottom: 10px; }

  .tier-card {
    background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 16px; padding: 16px; margin-bottom: 10px;
  }
  .tier-card.popular { border-color: var(--gold); box-shadow: 0 0 0 1px rgba(0,0,0,0.3), 0 4px 20px rgba(212,168,67,0.2); }
  .tier-card h4 { font-family: var(--font-display); font-size: 18px; letter-spacing: 2px; }
  .tier-price { font-size: 22px; font-weight: 700; color: var(--gold); margin: 6px 0; }
  .tier-price span { font-size: 13px; color: var(--white-dim); font-weight: 400; }
  .tier-features { list-style: none; margin: 10px 0; }
  .tier-features li { padding: 3px 0; font-size: 14px; color: var(--white-dim); }
  .tier-features li::before { content: '‚öî '; color: var(--gold); }

  .subscribe-btn {
    width: 100%; min-height: var(--touch-min); padding: 12px;
    border: none; border-radius: 12px;
    font-family: var(--font-display); font-size: 14px; letter-spacing: 2px;
    cursor: pointer;
  }
  .subscribe-btn.primary { background: linear-gradient(135deg, var(--red) 0%, var(--red-hover) 100%); color: #fff; box-shadow: 0 4px 16px rgba(193,39,45,0.3); }
  .subscribe-btn.primary:active { background: var(--red-hover); }
  .subscribe-btn.outline { background: transparent; color: var(--gold); border: 1px solid var(--gold-dim); }
  .subscribe-btn.outline:active { background: rgba(212,168,67,0.1); }

  .token-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .token-pack {
    background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 14px; padding: 16px 12px; text-align: center;
    cursor: pointer; min-height: 80px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .token-pack:active { border-color: rgba(212,168,67,0.3); }
  .token-amount { font-family: var(--font-display); font-size: 26px; color: var(--gold); }
  .token-price { font-size: 14px; font-weight: 600; margin-top: 4px; }

  /* === BOTTOM NAV === */
  .bottom-nav {
    position: fixed; bottom: 0; left: 0; right: 0; z-index: 100;
    height: calc(var(--bottom-nav-height) + var(--safe-bottom));
    padding-bottom: var(--safe-bottom);
    background: linear-gradient(0deg, rgba(26,45,74,0.95) 0%, rgba(26,45,74,0.7) 70%, transparent 100%);
    display: flex; align-items: center; justify-content: space-around;
    flex-shrink: 0;
  }

  .bottom-nav-btn {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 2px; background: none; border: none;
    color: var(--white-dim); cursor: pointer;
    min-width: var(--touch-min); min-height: var(--touch-min);
    padding: 4px 8px;
    transition: color 0.2s, opacity 0.2s;
  }
  .bottom-nav-btn:active { color: var(--white); }
  .bottom-nav-btn.active { color: var(--gold); }
  .bottom-nav-btn .nav-label { font-size: 9px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
  .bottom-nav-btn .nav-icon { font-size: 22px; }

  /* === LOADING === */
  .loading-screen {
    position: fixed; inset: 0; background: linear-gradient(145deg, #1a2d4a 0%, #2d5a8e 50%, #3d5a80 100%);
    display: flex; align-items: center; justify-content: center;
    flex-direction: column; gap: 16px; z-index: 9999; transition: opacity 0.4s;
  }
  .loading-screen.fade-out { opacity: 0; pointer-events: none; }
  .loading-logo { font-family: var(--font-display); font-weight: 900; font-size: 28px; letter-spacing: 5px; color: var(--gold); text-shadow: 0 0 30px rgba(212,168,67,0.3); }
  .loading-spinner { width: 28px; height: 28px; border: 3px solid var(--navy-mid); border-top-color: var(--gold); border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* === LIVE BADGE (reusable) === */
  .live-badge { display: inline-flex; align-items: center; gap: 5px; background: var(--red); padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }

  /* === EMPTY STATE === */
  .empty-state { text-align: center; padding: 32px 16px; color: var(--white-dim); }
  .empty-state .empty-icon { font-size: 40px; margin-bottom: 10px; }
  .empty-state h3 { font-family: var(--font-display); font-size: 18px; letter-spacing: 2px; color: var(--white); margin-bottom: 8px; }

</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loading-screen" class="loading-screen">
  <div class="loading-logo">COLOSSEUM</div>
  <div class="loading-spinner"></div>
</div>

<!-- TOP NAV -->
<nav class="top-nav">
  <div class="logo">COLOSSEUM</div>
  <div class="top-nav-right">
    <div class="token-bar" id="token-display">
      ü™ô <span id="token-count">0</span>
    </div>
    <button class="nav-icon-btn" id="notif-btn" title="Notifications">
      üîî
      <div class="notification-dot" id="notif-dot" style="display:none;"></div>
    </button>
    <div class="user-avatar-small" id="user-avatar-btn" title="Account">?</div>
  </div>
</nav>

<!-- LIVE STRIP -->
<div class="live-strip">
  <div class="live-dot"></div>
  <span id="live-strip-text">3 live now ¬∑ 12 hot takes ¬∑ 47 online</span>
  <span class="placeholder-tag">placeholder</span>
</div>

<!-- USER DROPDOWN -->
<div class="user-dropdown" id="user-dropdown">
  <div style="padding:10px 16px; border-bottom:1px solid var(--glass-border);">
    <div style="font-weight:700;" id="dropdown-name">Gladiator</div>
    <div style="font-size:12px; color:var(--white-dim);" id="dropdown-tier">Free Tier</div>
  </div>
  <a href="colosseum-settings.html" class="dropdown-item">‚öôÔ∏è Settings</a>
  <a href="colosseum-profile-depth.html" class="dropdown-item">üìä Complete Profile</a>
  <div class="dropdown-divider"></div>
  <button class="dropdown-item danger" id="logout-btn">üö™ Log Out</button>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">

  <!-- HOME SCREEN ‚Äî SPOKE CAROUSEL -->
  <div class="screen active" id="screen-home">
    <div class="carousel-stage" id="carouselStage">
      <div class="carousel-ring" id="ring">
        <div class="cat-tile hot" data-cat="politics">
          <div class="tile-icon">üèõÔ∏è</div>
          <div class="tile-label">Politics</div>
          <div class="tile-count">2 live</div>
        </div>
        <div class="cat-tile" data-cat="sports">
          <div class="tile-icon">üèÜ</div>
          <div class="tile-label">Sports</div>
          <div class="tile-count">14 takes</div>
        </div>
        <div class="cat-tile" data-cat="entertainment">
          <div class="tile-icon">üé¨</div>
          <div class="tile-label">Entertainment</div>
          <div class="tile-count">8 takes</div>
        </div>
        <div class="cat-tile hot" data-cat="couples">
          <div class="tile-icon">üíî</div>
          <div class="tile-label">Couples Court</div>
          <div class="tile-count">1 live</div>
        </div>
        <div class="cat-tile" data-cat="trending">
          <div class="tile-icon">üî•</div>
          <div class="tile-label">Trending</div>
          <div class="tile-count">22 takes</div>
        </div>
        <div class="cat-tile" data-cat="music">
          <div class="tile-icon">üéµ</div>
          <div class="tile-label">Music</div>
          <div class="tile-count">5 takes</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ARENA SCREEN ‚Äî rendered by colosseum-arena.js -->
  <div class="screen" id="screen-arena">
    <!-- ColosseumArena.render() fills this -->
  </div>

  <!-- PROFILE SCREEN -->
  <div class="screen" id="screen-profile">
    <div class="profile-header">
      <div class="profile-avatar" id="profile-avatar">?</div>
      <div class="profile-name" id="profile-display-name">GLADIATOR</div>
      <div class="profile-tier" id="profile-tier">FREE TIER</div>
      <div class="profile-depth-bar">
        <div class="profile-depth-fill" id="profile-depth-fill" style="width:0%"></div>
      </div>
      <div class="profile-depth-text" id="profile-depth-text">Profile 0% complete ‚Äî <a href="colosseum-profile-depth.html" style="color:var(--gold);">unlock rewards</a></div>
    </div>
    <div class="stat-grid">
      <div class="stat-box"><div class="stat-value" id="stat-elo">1200</div><div class="stat-label">ELO</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-wins">0</div><div class="stat-label">WINS</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-losses">0</div><div class="stat-label">LOSSES</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-streak">0</div><div class="stat-label">STREAK</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-level">1</div><div class="stat-label">LEVEL</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-debates">0</div><div class="stat-label">DEBATES</div></div>
    </div>
    <div class="profile-link-list">
      <a href="colosseum-profile-depth.html" class="profile-link"><span class="link-label">üìä Complete Your Profile</span><span class="link-arrow">‚Üí</span></a>
      <a href="colosseum-settings.html" class="profile-link"><span class="link-label">‚öôÔ∏è Settings</span><span class="link-arrow">‚Üí</span></a>
      <div class="profile-link" onclick="navigateTo('shop')"><span class="link-label">üõí Cosmetics Shop</span><span class="link-arrow">‚Üí</span></div>
      <div class="profile-link" onclick="ColosseumShare?.shareProfile?.({userId:ColosseumAuth?.currentUser?.id,username:ColosseumAuth?.currentProfile?.username,displayName:ColosseumAuth?.currentProfile?.display_name,elo:ColosseumAuth?.currentProfile?.elo_rating,wins:ColosseumAuth?.currentProfile?.wins,losses:ColosseumAuth?.currentProfile?.losses,streak:ColosseumAuth?.currentProfile?.current_streak})"><span class="link-label">üîó Share Profile</span><span class="link-arrow">‚Üí</span></div>
      <div class="profile-link" onclick="ColosseumShare?.inviteFriend?.()"><span class="link-label">üì® Invite a Friend</span><span class="link-arrow">‚Üí</span></div>
    </div>
  </div>

  <!-- SHOP SCREEN -->
  <div class="screen" id="screen-shop">
    <div class="section-banner"><h2>üõí THE ARMORY</h2><div class="subtitle">Gear up. Stand out. Dominate.</div></div>
    <div class="shop-section">
      <h3>SUBSCRIPTION TIERS</h3>
      <div class="tier-card"><h4>‚öîÔ∏è CONTENDER</h4><div class="tier-price">$9.99 <span>/mo</span></div><ul class="tier-features"><li>Ad-free experience</li><li>Custom profile themes</li><li>30 tokens/day</li><li>Priority matchmaking</li></ul><button class="subscribe-btn outline" onclick="ColosseumPayments?.subscribe?.('contender')">UPGRADE</button></div>
      <div class="tier-card popular"><h4>üèÜ CHAMPION</h4><div class="tier-price">$19.99 <span>/mo</span></div><ul class="tier-features"><li>Everything in Contender</li><li>Exclusive cosmetics</li><li>Create private rooms</li><li>Detailed analytics</li></ul><button class="subscribe-btn primary" onclick="ColosseumPayments?.subscribe?.('champion')">UPGRADE</button></div>
      <div class="tier-card"><h4>üëë CREATOR</h4><div class="tier-price">$29.99 <span>/mo</span></div><ul class="tier-features"><li>Everything in Champion</li><li>Creator tools & overlays</li><li>Revenue share on bookings</li><li>Early access to features</li></ul><button class="subscribe-btn outline" onclick="ColosseumPayments?.subscribe?.('creator')">UPGRADE</button></div>
    </div>
    <div class="shop-section">
      <h3>TOKEN PACKS</h3>
      <div class="token-grid">
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_50')"><div class="token-amount">50</div><div class="token-price">$0.99</div></div>
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_250')"><div class="token-amount">250</div><div class="token-price">$3.99</div></div>
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_600')"><div class="token-amount">600</div><div class="token-price">$7.99</div></div>
        <div class="token-pack" onclick="ColosseumPayments?.buyTokens?.('tokens_1800')"><div class="token-amount">1,800</div><div class="token-price">$19.99</div></div>
      </div>
    </div>
  </div>

  <!-- LEADERBOARD SCREEN -->
  <div class="screen" id="screen-leaderboard">
    <!-- Rendered by colosseum-leaderboard.js -->
  </div>
</div>

<!-- HOT TAKE FAB -->
<button class="hot-take-fab" aria-label="Post Hot Take" onclick="ColosseumAsync?.openComposer?.()">üî•</button>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="bottom-nav-btn active" data-screen="home"><span class="nav-icon">üè†</span><span class="nav-label">Home</span></button>
  <button class="bottom-nav-btn" data-screen="arena"><span class="nav-icon">‚öîÔ∏è</span><span class="nav-label">Arena</span></button>
  <button class="bottom-nav-btn" data-screen="shop"><span class="nav-icon">üõí</span><span class="nav-label">Shop</span></button>
  <button class="bottom-nav-btn" data-screen="leaderboard"><span class="nav-icon">üèÜ</span><span class="nav-label">Ranks</span></button>
  <button class="bottom-nav-btn" data-screen="profile"><span class="nav-icon">üë§</span><span class="nav-label">Profile</span></button>
</nav>

<!-- CATEGORY EXPAND OVERLAY -->
<div class="category-expand" id="catExpand">
  <div class="expand-header">
    <div class="expand-title" id="expandTitle">POLITICS</div>
    <button class="expand-close" onclick="closeCategory()">‚úï</button>
  </div>
  <div id="expandContent"></div>
</div>

<script>
// ============================================================
// APP SHELL ‚Äî V3 New Age + Spoke Carousel
// ============================================================

// --- Navigation (Item 14.6.1.4: continue where you left off) ---
function navigateTo(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.bottom-nav-btn').forEach(b => b.classList.remove('active'));

  const screen = document.getElementById('screen-' + screenId);
  if (screen) screen.classList.add('active');

  const btn = document.querySelector(`.bottom-nav-btn[data-screen="${screenId}"]`);
  if (btn) btn.classList.add('active');

  document.querySelector('.main-content')?.scrollTo(0, 0);
  try { localStorage.setItem('colosseum_last_screen', screenId); } catch(e) {}
}

document.querySelectorAll('.bottom-nav-btn').forEach(btn => {
  btn.addEventListener('click', () => navigateTo(btn.dataset.screen));
});

// --- User Dropdown ---
const avatarBtn = document.getElementById('user-avatar-btn');
const dropdown = document.getElementById('user-dropdown');
avatarBtn.addEventListener('click', (e) => { e.stopPropagation(); dropdown.classList.toggle('open'); });
document.addEventListener('click', () => { dropdown.classList.remove('open'); });

// --- Logout ---
document.getElementById('logout-btn').addEventListener('click', async () => {
  if (typeof ColosseumAuth !== 'undefined' && ColosseumAuth.logOut) await ColosseumAuth.logOut();
  window.location.href = 'colosseum-login.html';
});

// --- Auth State ‚Üí UI ---
function updateUIFromProfile(user, profile) {
  if (!profile) return;
  const initial = (profile.display_name || profile.username || '?')[0].toUpperCase();
  document.getElementById('user-avatar-btn').textContent = initial;
  document.getElementById('profile-avatar').textContent = initial;
  document.getElementById('profile-display-name').textContent = (profile.display_name || profile.username || 'GLADIATOR').toUpperCase();
  const tierLabels = { free: 'FREE TIER', contender: 'CONTENDER', champion: 'CHAMPION', creator: 'CREATOR' };
  const tier = profile.subscription_tier || 'free';
  document.getElementById('profile-tier').textContent = tierLabels[tier] || 'FREE TIER';
  document.getElementById('dropdown-name').textContent = profile.display_name || profile.username || 'Gladiator';
  document.getElementById('dropdown-tier').textContent = tierLabels[tier] || 'Free Tier';
  document.getElementById('stat-elo').textContent = profile.elo_rating || 1200;
  document.getElementById('stat-wins').textContent = profile.wins || 0;
  document.getElementById('stat-losses').textContent = profile.losses || 0;
  document.getElementById('stat-streak').textContent = profile.current_streak || 0;
  document.getElementById('stat-level').textContent = profile.level || 1;
  document.getElementById('stat-debates').textContent = profile.debates_completed || 0;
  document.getElementById('token-count').textContent = profile.token_balance || 0;
  const depth = profile.profile_depth_pct || 0;
  document.getElementById('profile-depth-fill').style.width = depth + '%';
  document.getElementById('profile-depth-text').innerHTML = `Profile ${depth}% complete ‚Äî <a href="colosseum-profile-depth.html" style="color:var(--gold);">unlock rewards</a>`;
}

if (typeof ColosseumAuth !== 'undefined') {
  ColosseumAuth.onChange(updateUIFromProfile);
}

// ============================================================
// SPOKE CAROUSEL ‚Äî category wheel
// ============================================================
const ring = document.getElementById('ring');
const stage = document.getElementById('carouselStage');
const tiles = Array.from(document.querySelectorAll('.cat-tile'));
const COUNT = tiles.length;
const SLICE = 360 / COUNT;

const getRadius = () => Math.min(window.innerWidth * 0.42, 180);
let angle = 0;

function layoutTiles() {
  const R = getRadius();
  tiles.forEach((tile, i) => {
    const a = (SLICE * i) + angle;
    const rad = a * Math.PI / 180;
    const x = Math.sin(rad) * R;
    const z = Math.cos(rad) * R;
    const normZ = (z + R) / (2 * R);
    const scale = 0.6 + normZ * 0.4;
    const opacity = 0.35 + normZ * 0.65;
    tile.style.transform = `translateX(${x}px) translateZ(${z}px) scale(${scale})`;
    tile.style.opacity = opacity;
    tile.style.zIndex = Math.round(normZ * 100);
    tile.style.pointerEvents = normZ > 0.4 ? 'auto' : 'none';
  });
}

layoutTiles();
window.addEventListener('resize', layoutTiles);

let isDragging = false, lastX = 0, velocity = 0, lastTime = 0, driftFrame = null;

stage.addEventListener('touchstart', onStart, { passive: true });
stage.addEventListener('touchmove', onMove, { passive: true });
stage.addEventListener('touchend', onEnd);
stage.addEventListener('mousedown', onStart);
window.addEventListener('mousemove', onMove);
window.addEventListener('mouseup', onEnd);

function getX(e) { return e.touches ? e.touches[0].clientX : e.clientX; }
function onStart(e) { isDragging = true; lastX = getX(e); lastTime = Date.now(); velocity = 0; cancelAnimationFrame(driftFrame); }
function onMove(e) {
  if (!isDragging) return;
  const x = getX(e), now = Date.now(), dt = Math.max(now - lastTime, 1), dx = x - lastX;
  angle += dx * 0.35; velocity = (dx / dt) * 16;
  lastX = x; lastTime = now; layoutTiles();
}
function onEnd() { if (!isDragging) return; isDragging = false; drift(); }
function drift() {
  if (isDragging) return;
  angle += velocity; velocity *= 0.955; layoutTiles();
  if (Math.abs(velocity) > 0.05) driftFrame = requestAnimationFrame(drift);
}

let idleT = 0;
function idleSway() {
  if (!isDragging && Math.abs(velocity) < 0.06) { idleT += 0.008; angle += Math.sin(idleT) * 0.04; layoutTiles(); }
  requestAnimationFrame(idleSway);
}
idleSway();

// ============================================================
// CATEGORY EXPAND ‚Äî placeholder data (replace with Supabase)
// ============================================================
tiles.forEach(tile => { tile.addEventListener('click', () => { const cat = tile.dataset.cat; if (cat) openCategory(cat); }); });

const catExpand = document.getElementById('catExpand');
const expandTitle = document.getElementById('expandTitle');
const expandContent = document.getElementById('expandContent');

// PLACEHOLDER DATA ‚Äî swap with real Supabase queries later
const PLACEHOLDER_DATA = {
  politics: { label: 'üèõÔ∏è POLITICS', items: [
    { type: 'live debate', title: '"Biden vs Trump Legacy" ‚Äî Round 3', meta: '47 watching ¬∑ 2:14 left', action: 'Watch Live', live: true },
    { type: 'hot take', title: '"Term limits would fix everything"', meta: '4m ago ¬∑ 23 reactions', action: 'React' },
    { type: 'challenge', title: 'JerseyMike44 challenged you', meta: '"Immigration policy is broken"', action: 'Accept Challenge' },
    { type: 'tonight\'s card', title: '"Is democracy dying?" ‚Äî 9PM EST', meta: '12 predictions', action: 'Predict Winner' },
  ]},
  sports: { label: 'üèÜ SPORTS', items: [
    { type: 'hot take', title: '"Mahomes is already the GOAT"', meta: '58 reactions ¬∑ 4 challenges', action: 'React' },
    { type: 'hot take', title: '"NBA regular season is pointless"', meta: '31 reactions', action: 'React' },
    { type: 'tonight\'s card', title: '"Is Iverson underrated?" ‚Äî 8PM', meta: '8 predictions', action: 'Predict Winner' },
  ]},
  entertainment: { label: 'üé¨ ENTERTAINMENT', items: [
    { type: 'hot take', title: '"Marvel is creatively bankrupt"', meta: '44 reactions', action: 'React' },
    { type: 'hot take', title: '"Streaming killed the movie theater"', meta: '19 reactions', action: 'React' },
  ]},
  couples: { label: 'üíî COUPLES COURT', items: [
    { type: 'live debate', title: '"She checked his phone ‚Äî justified?"', meta: '31 watching', action: 'Watch Live', live: true },
    { type: 'hot take', title: '"Splitting bills 50/50 is fair"', meta: '67 reactions', action: 'React' },
    { type: 'challenge', title: '"Long distance never works"', meta: 'Open challenge', action: 'Accept' },
  ]},
  trending: { label: 'üî• TRENDING', items: [
    { type: 'hot take', title: '"AI will replace 50% of jobs by 2030"', meta: '102 reactions ¬∑ #1', action: 'React' },
    { type: 'hot take', title: '"College degrees are a scam"', meta: '88 reactions', action: 'React' },
    { type: 'hot take', title: '"Tipping culture has gone too far"', meta: '71 reactions', action: 'React' },
  ]},
  music: { label: 'üéµ MUSIC', items: [
    { type: 'hot take', title: '"Drake fell off"', meta: '34 reactions', action: 'React' },
    { type: 'hot take', title: '"Vinyl sounds better ‚Äî prove me wrong"', meta: '12 reactions', action: 'React' },
  ]}
};

function openCategory(cat) {
  const data = PLACEHOLDER_DATA[cat];
  if (!data) return;
  expandTitle.textContent = data.label;
  expandContent.innerHTML = data.items.map(item => `
    <div class="expand-content-card">
      <div class="expand-card-type">${item.type} <span class="placeholder-tag">placeholder</span></div>
      <div class="expand-card-title">${item.title}</div>
      <div class="expand-card-meta">${item.meta}</div>
      <div class="expand-card-action ${item.live ? 'live' : ''}">${item.action}</div>
    </div>
  `).join('');
  catExpand.classList.add('open');
}

function closeCategory() { catExpand.classList.remove('open'); }

let expandStartY = 0;
catExpand.addEventListener('touchstart', (e) => { expandStartY = e.touches[0].clientY; }, { passive: true });
catExpand.addEventListener('touchend', (e) => { if (e.changedTouches[0].clientY - expandStartY > 80) closeCategory(); });

// ============================================================
// INIT
// ============================================================
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    const loading = document.getElementById('loading-screen');
    loading.classList.add('fade-out');
    setTimeout(() => loading.remove(), 400);

    if (typeof ColosseumAuth === 'undefined') {
      window.ColosseumAuth = { currentUser: null, currentProfile: null, isPlaceholderMode: true, listeners: [], onChange(){}, _notify(){} };
    }

    if (!ColosseumAuth.currentUser && !ColosseumAuth.isPlaceholderMode) {
      window.location.href = 'colosseum-login.html';
      return;
    }

    if (ColosseumAuth.isPlaceholderMode) {
      updateUIFromProfile(null, {
        display_name: 'Gladiator', username: 'gladiator',
        elo_rating: 1200, wins: 0, losses: 0, current_streak: 0,
        level: 1, debates_completed: 0, token_balance: 50,
        subscription_tier: 'free', profile_depth_pct: 0,
      });
    }

    try {
      const urlScreen = new URLSearchParams(window.location.search).get('screen');
      const lastScreen = urlScreen || localStorage.getItem('colosseum_last_screen');
      if (lastScreen && document.getElementById('screen-' + lastScreen)) {
        navigateTo(lastScreen);
      }
    } catch(e) {}
  }, 800);
});

// --- Payment success/cancel ---
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('payment') === 'success') {
  const toast = document.createElement('div');
  toast.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:var(--success);color:#fff;padding:12px 24px;border-radius:12px;font-weight:700;z-index:9999;font-family:var(--font-body);';
  toast.textContent = '‚úÖ Payment successful!';
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
  window.history.replaceState({}, '', window.location.pathname);
}
if (urlParams.get('payment') === 'canceled') {
  const toast = document.createElement('div');
  toast.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:var(--glass-heavy);color:var(--white-dim);padding:12px 24px;border-radius:12px;font-weight:600;z-index:9999;border:1px solid var(--glass-border);font-family:var(--font-body);';
  toast.textContent = 'Payment canceled.';
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
  window.history.replaceState({}, '', window.location.pathname);
}
</script>
</body>
</html>
