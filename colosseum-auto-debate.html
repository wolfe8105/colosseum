<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1a2d4a">

<!-- Dynamic OG Meta Tags ‚Äî defaults, updated per-debate when server-side rendering exists -->
<meta property="og:type" content="website">
<meta property="og:title" content="AI Debate Breakdown ‚Äî The Colosseum">
<meta property="og:description" content="AI judged this debate and the result is controversial. Cast your vote.">
<meta property="og:image" content="https://colosseum-six.vercel.app/og-card-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://colosseum-six.vercel.app/colosseum-auto-debate.html">
<meta property="og:site_name" content="The Colosseum">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="AI Debate Breakdown ‚Äî The Colosseum">
<meta name="twitter:description" content="AI judged this debate and the result is controversial. Cast your vote.">
<meta name="twitter:image" content="https://colosseum-six.vercel.app/og-card-default.png">

<title>AI Debate ‚Äî The Colosseum</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Barlow+Condensed:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg-1:#1a2d4a;--bg-2:#2d5a8e;--bg-3:#5b8abf;--bg-4:#7aa3d4;--bg-5:#3d5a80;
  --navy:#0a1628;--navy-light:#132240;--navy-mid:#1a2d4a;
  --card-bg:rgba(10,17,40,0.6);--card-border:rgba(255,255,255,0.22);--card-border-hover:rgba(255,255,255,0.4);
  --red:#cc2936;--red-hover:#e63946;--gold:#d4a843;--gold-dim:#b8922e;
  --white:#f0f0f0;--white-dim:#a0a8b8;--success:#2ecc71;--error:#e74c3c;
  --font-display:'Cinzel',serif;--font-body:'Barlow Condensed',sans-serif;
  --safe-top:env(safe-area-inset-top,0px);--safe-bottom:env(safe-area-inset-bottom,0px);
  --side-a:#3b82f6;--side-b:#ef4444;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{-webkit-text-size-adjust:100%}
body{
  font-family:var(--font-body);color:var(--white);min-height:100dvh;
  background:var(--bg-1);overflow-y:auto;
  -webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent;
  display:flex;flex-direction:column;align-items:center;
  padding:0 0 calc(80px + var(--safe-bottom));
}
body::before{content:'';position:fixed;inset:0;background:linear-gradient(135deg,#1a2d4a 0%,#2d5a8e 25%,#5b8abf 50%,#7aa3d4 70%,#3d5a80 100%);z-index:-2}
body::after{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 30% 20%,rgba(212,168,67,0.06) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(204,41,54,0.04) 0%,transparent 50%);z-index:-1}

/* TOP BAR */
.top-bar{
  width:100%;padding:calc(12px + var(--safe-top)) 16px 12px;
  background:rgba(10,17,40,0.5);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,255,255,0.08);
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:100;
}
.logo{font-family:var(--font-display);font-size:16px;font-weight:700;letter-spacing:3px;color:var(--gold);text-transform:uppercase;text-decoration:none}
.logo .the{font-weight:400;color:var(--white-dim);font-size:11px;letter-spacing:4px;display:block;line-height:1;margin-bottom:-2px}
.join-btn{
  padding:8px 18px;border-radius:20px;border:1px solid var(--gold-dim);
  background:rgba(212,168,67,0.1);color:var(--gold);
  font-family:var(--font-body);font-size:14px;font-weight:600;letter-spacing:1px;
  cursor:pointer;transition:all 0.2s;text-decoration:none;
}
.join-btn:active{background:rgba(212,168,67,0.2);transform:scale(0.96)}

/* CONTAINER */
.container{width:100%;max-width:520px;padding:0 16px;display:flex;flex-direction:column;gap:16px;margin-top:16px}

/* LOADING */
.loading{text-align:center;padding:60px 20px;color:var(--white-dim);font-size:16px}
.loading .spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,0.1);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 16px}
@keyframes spin{to{transform:rotate(360deg)}}

/* ERROR STATE */
.error-state{text-align:center;padding:60px 20px;color:var(--error);font-size:16px}

/* BADGE */
.ai-badge{
  align-self:flex-start;display:inline-flex;align-items:center;gap:6px;
  padding:5px 12px;border-radius:20px;font-size:12px;font-weight:600;
  letter-spacing:1.5px;text-transform:uppercase;
  background:rgba(212,168,67,0.1);border:1px solid rgba(212,168,67,0.3);
  color:var(--gold);
}
.cat-pill{
  display:inline-flex;align-items:center;gap:5px;
  padding:5px 12px;border-radius:20px;font-size:12px;font-weight:600;
  letter-spacing:1px;text-transform:uppercase;
  background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);
  color:var(--white-dim);margin-left:8px;
}

/* TOPIC */
.topic-card{
  background:var(--card-bg);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  border:1px solid var(--card-border);border-radius:18px;
  padding:24px 20px;text-align:center;
}
.topic-text{
  font-family:var(--font-display);font-size:22px;font-weight:700;
  letter-spacing:1px;line-height:1.3;color:var(--white);margin-bottom:8px;
}
.topic-desc{font-size:14px;color:var(--white-dim);line-height:1.4}

/* MATCHUP BAR */
.matchup-bar{
  display:flex;align-items:center;gap:0;
  background:var(--card-bg);border:1px solid var(--card-border);border-radius:14px;
  overflow:hidden;
}
.matchup-side{
  flex:1;padding:14px 12px;text-align:center;
  font-family:var(--font-display);font-size:14px;font-weight:700;
  letter-spacing:1px;
}
.matchup-side.side-a{background:rgba(59,130,246,0.08);color:var(--side-a);border-right:1px solid rgba(255,255,255,0.08)}
.matchup-side.side-b{background:rgba(239,68,68,0.08);color:var(--side-b)}
.matchup-vs{
  padding:0 12px;font-family:var(--font-display);font-size:12px;font-weight:700;
  color:var(--gold);letter-spacing:2px;flex-shrink:0;
}

/* ROUNDS */
.section-label{
  font-family:var(--font-display);font-size:13px;font-weight:700;
  letter-spacing:3px;text-transform:uppercase;color:var(--gold-dim);
  margin-top:4px;
}
.round-card{
  background:var(--card-bg);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
  border:1px solid var(--card-border);border-radius:16px;
  overflow:hidden;
}
.round-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 16px;background:rgba(255,255,255,0.03);
  border-bottom:1px solid rgba(255,255,255,0.06);
}
.round-num{font-family:var(--font-display);font-size:12px;font-weight:700;letter-spacing:2px;color:var(--gold-dim);text-transform:uppercase}
.round-scores{display:flex;gap:12px;font-size:13px;font-weight:600}
.round-scores .sa{color:var(--side-a)}.round-scores .sb{color:var(--side-b)}

.round-body{display:flex;flex-direction:column;gap:0}
.round-argument{padding:14px 16px;font-size:15px;line-height:1.5;position:relative}
.round-argument + .round-argument{border-top:1px solid rgba(255,255,255,0.04)}
.round-argument .arg-label{
  font-family:var(--font-display);font-size:11px;font-weight:700;
  letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;display:block;
}
.round-argument.side-a .arg-label{color:var(--side-a)}
.round-argument.side-b .arg-label{color:var(--side-b)}
.round-argument .arg-text{color:var(--white);opacity:0.9}

/* SCOREBOARD */
.scoreboard{
  background:var(--card-bg);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  border:1px solid var(--card-border);border-radius:18px;
  padding:20px;text-align:center;
}
.score-label{font-family:var(--font-display);font-size:12px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--gold);margin-bottom:14px}
.score-row{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:14px}
.score-side{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  min-width:80px;
}
.score-name{font-family:var(--font-display);font-size:13px;font-weight:600;letter-spacing:1px}
.score-side.side-a .score-name{color:var(--side-a)}.score-side.side-b .score-name{color:var(--side-b)}
.score-number{
  font-family:var(--font-display);font-size:36px;font-weight:900;letter-spacing:2px;
}
.score-side.side-a .score-number{color:var(--side-a)}.score-side.side-b .score-number{color:var(--side-b)}
.score-side.winner .score-number{text-shadow:0 0 20px currentColor}
.score-dash{font-size:28px;color:var(--white-dim);font-weight:300}
.margin-pill{
  display:inline-block;padding:4px 14px;border-radius:20px;font-size:12px;font-weight:700;
  letter-spacing:1.5px;text-transform:uppercase;margin-bottom:10px;
}
.margin-pill.close{background:rgba(212,168,67,0.15);color:var(--gold);border:1px solid rgba(212,168,67,0.3)}
.margin-pill.clear{background:rgba(239,68,68,0.12);color:var(--red);border:1px solid rgba(239,68,68,0.25)}
.margin-pill.landslide{background:rgba(239,68,68,0.2);color:#ff6b6b;border:1px solid rgba(239,68,68,0.4)}

.judge-take{
  font-size:15px;line-height:1.5;color:var(--white);opacity:0.85;
  font-style:italic;padding:0 8px;margin-top:4px;
}
.judge-label{font-size:12px;color:var(--gold-dim);font-weight:600;letter-spacing:1px;margin-bottom:6px}

/* VOTE SECTION */
.vote-section{
  background:var(--card-bg);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  border:2px solid var(--gold-dim);border-radius:18px;
  padding:20px;text-align:center;
}
.vote-headline{font-family:var(--font-display);font-size:18px;font-weight:700;letter-spacing:1px;color:var(--gold);margin-bottom:4px}
.vote-sub{font-size:14px;color:var(--white-dim);margin-bottom:16px}
.vote-row{display:flex;gap:10px}
.vote-btn{
  flex:1;padding:16px 12px;border-radius:14px;border:2px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.04);cursor:pointer;transition:all 0.2s;
  display:flex;flex-direction:column;align-items:center;gap:4px;min-height:64px;
  -webkit-tap-highlight-color:transparent;
}
.vote-btn .vote-label{font-family:var(--font-display);font-size:14px;font-weight:700;letter-spacing:1px;color:var(--white)}
.vote-btn:active{transform:scale(0.97)}
.vote-btn.va:hover,.vote-btn.va:active{border-color:var(--side-a);background:rgba(59,130,246,0.1)}
.vote-btn.vb:hover,.vote-btn.vb:active{border-color:var(--side-b);background:rgba(239,68,68,0.1)}
.vote-btn.voted{pointer-events:none;opacity:0.6}
.vote-btn.voted.winner{opacity:1;border-color:var(--gold);background:rgba(212,168,67,0.1)}

/* RESULTS */
.results-section{display:none;flex-direction:column;gap:12px;margin-top:12px}
.results-section.show{display:flex}
.vote-bar-track{width:100%;height:40px;border-radius:10px;background:rgba(255,255,255,0.06);overflow:hidden;display:flex;position:relative}
.vote-bar-fill{height:100%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;transition:width 0.8s cubic-bezier(0.16,1,0.3,1);min-width:40px}
.vote-bar-fill.a-fill{background:rgba(59,130,246,0.3);color:var(--side-a)}
.vote-bar-fill.b-fill{background:rgba(239,68,68,0.3);color:var(--side-b)}
.vote-count{text-align:center;font-size:13px;color:var(--white-dim)}
.disagree-label{font-family:var(--font-display);font-size:14px;font-weight:700;color:var(--gold);letter-spacing:1px;text-align:center;margin-top:4px}

/* CTA */
.cta-banner{
  background:linear-gradient(135deg,rgba(212,168,67,0.12) 0%,rgba(204,41,54,0.08) 100%);
  border:1px solid rgba(212,168,67,0.25);border-radius:18px;
  padding:24px 20px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:14px;
}
.cta-headline{font-family:var(--font-display);font-size:17px;font-weight:700;letter-spacing:1px;color:var(--gold)}
.cta-sub{font-size:14px;color:var(--white-dim);line-height:1.4}
.cta-btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:14px 32px;border-radius:14px;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--gold) 0%,var(--gold-dim) 100%);
  color:var(--navy);font-family:var(--font-display);font-size:15px;
  font-weight:700;letter-spacing:2px;text-transform:uppercase;
  text-decoration:none;transition:all 0.2s;min-height:48px;
}
.cta-btn:active{transform:scale(0.97);opacity:0.9}

/* SHARE BAR */
.share-bar{
  display:flex;gap:8px;justify-content:center;flex-wrap:wrap;
}
.share-btn{
  padding:10px 18px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.04);color:var(--white-dim);
  font-family:var(--font-body);font-size:13px;font-weight:600;
  cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px;
}
.share-btn:active{background:rgba(255,255,255,0.08);transform:scale(0.97)}

/* FOOTER */
.footer{
  margin-top:20px;padding:20px;text-align:center;
  font-size:12px;color:rgba(255,255,255,0.3);
}
.footer a{color:var(--gold-dim);text-decoration:none}

/* ANIMATIONS */
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.fade-up{animation:fadeUp 0.5s ease-out forwards;opacity:0}
.fade-up:nth-child(1){animation-delay:0.05s}
.fade-up:nth-child(2){animation-delay:0.1s}
.fade-up:nth-child(3){animation-delay:0.15s}
.fade-up:nth-child(4){animation-delay:0.2s}
.fade-up:nth-child(5){animation-delay:0.25s}
.fade-up:nth-child(6){animation-delay:0.3s}
.fade-up:nth-child(7){animation-delay:0.35s}
.fade-up:nth-child(8){animation-delay:0.4s}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="top-bar">
  <a href="/" class="logo"><span class="the">THE</span>COLOSSEUM</a>
  <a href="/colosseum-login.html" class="join-btn">JOIN FREE</a>
</div>

<!-- MAIN CONTENT -->
<div class="container" id="app">
  <div class="loading" id="loading">
    <div class="spinner"></div>
    Loading debate...
  </div>
</div>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<!-- Config (for Supabase URL + anon key) -->
<script src="colosseum-config.js"></script>

<script>
(function() {
  'use strict';

  // ---- Init Supabase ----
  const cfg = window.ColosseumConfig || {};
  const sb = window.supabase.createClient(
    cfg.SUPABASE_URL || 'https://faomczmipsccwbhpivmp.supabase.co',
    cfg.SUPABASE_ANON_KEY || 'PASTE_YOUR_ANON_KEY_HERE'
  );

  const app = document.getElementById('app');
  const loading = document.getElementById('loading');

  // ---- Get debate ID from URL ----
  const params = new URLSearchParams(window.location.search);
  const debateId = params.get('id');

  if (!debateId) {
    showError('No debate specified. Check the link and try again.');
    return;
  }

  // ---- Fingerprint for anonymous voting ----
  function getFingerprint() {
    let fp = localStorage.getItem('col_fp');
    if (!fp) {
      fp = 'fp_' + Math.random().toString(36).substr(2, 12) + Date.now().toString(36);
      localStorage.setItem('col_fp', fp);
    }
    return fp;
  }

  // ---- Load debate ----
  async function loadDebate() {
    try {
      const { data, error } = await sb
        .from('auto_debates')
        .select('*')
        .eq('id', debateId)
        .eq('status', 'active')
        .single();

      if (error || !data) {
        showError('Debate not found or has been removed.');
        return;
      }

      // Track view (fire and forget)
      sb.rpc('view_auto_debate', { p_debate_id: debateId }).catch(() => {});

      renderDebate(data);
    } catch (err) {
      showError('Failed to load debate. Please try again.');
    }
  }

  // ---- Render ----
  function renderDebate(d) {
    const rounds = typeof d.rounds === 'string' ? JSON.parse(d.rounds) : d.rounds;
    const winnerLabel = d.winner === 'a' ? d.side_a_label : d.side_b_label;
    const loserLabel = d.winner === 'a' ? d.side_b_label : d.side_a_label;
    const marginText = d.margin === 'landslide' ? 'LANDSLIDE' : d.margin === 'clear' ? 'CLEAR WIN' : 'SPLIT DECISION';

    // Update page title + OG
    document.title = `${d.topic} ‚Äî The Colosseum`;

    let html = '';

    // Badges
    html += `<div class="fade-up" style="display:flex;align-items:center;flex-wrap:wrap;gap:6px">
      <span class="ai-badge">‚öîÔ∏è AI DEBATE</span>
      <span class="cat-pill">${getCatIcon(d.category)} ${d.category || 'general'}</span>
    </div>`;

    // Topic
    html += `<div class="topic-card fade-up">
      <div class="topic-text">${escHtml(d.topic)}</div>
      ${d.description ? `<div class="topic-desc">${escHtml(d.description)}</div>` : ''}
    </div>`;

    // Matchup bar
    html += `<div class="matchup-bar fade-up">
      <div class="matchup-side side-a">${escHtml(d.side_a_label)}</div>
      <div class="matchup-vs">VS</div>
      <div class="matchup-side side-b">${escHtml(d.side_b_label)}</div>
    </div>`;

    // Rounds
    html += `<div class="section-label fade-up">THE DEBATE</div>`;

    for (const r of rounds) {
      // Find round scores from judge reasoning metadata if available
      html += `<div class="round-card fade-up">
        <div class="round-header">
          <span class="round-num">Round ${r.round}</span>
        </div>
        <div class="round-body">
          <div class="round-argument side-a">
            <span class="arg-label">${escHtml(d.side_a_label)}</span>
            <span class="arg-text">${escHtml(r.sideA || r.side_a || '')}</span>
          </div>
          <div class="round-argument side-b">
            <span class="arg-label">${escHtml(d.side_b_label)}</span>
            <span class="arg-text">${escHtml(r.sideB || r.side_b || '')}</span>
          </div>
        </div>
      </div>`;
    }

    // Scoreboard
    html += `<div class="section-label fade-up">THE VERDICT</div>`;
    html += `<div class="scoreboard fade-up">
      <div class="score-label">AI JUDGE SCORECARD</div>
      <span class="margin-pill ${d.margin}">${marginText}</span>
      <div class="score-row">
        <div class="score-side side-a ${d.winner === 'a' ? 'winner' : ''}">
          <span class="score-name">${escHtml(d.side_a_label)}</span>
          <span class="score-number">${d.score_a}</span>
        </div>
        <span class="score-dash">‚Äî</span>
        <div class="score-side side-b ${d.winner === 'b' ? 'winner' : ''}">
          <span class="score-name">${escHtml(d.side_b_label)}</span>
          <span class="score-number">${d.score_b}</span>
        </div>
      </div>
      ${d.judge_reasoning ? `
        <div class="judge-label">JUDGE'S TAKE</div>
        <div class="judge-take">"${escHtml(d.judge_reasoning)}"</div>
      ` : ''}
    </div>`;

    // Vote section
    html += `<div class="vote-section fade-up" id="vote-section">
      <div class="vote-headline">WHO ACTUALLY WON?</div>
      <div class="vote-sub">The AI got it wrong? Prove it. No signup required.</div>
      <div class="vote-row">
        <button class="vote-btn va" onclick="castVote('a')" id="btn-a">
          <span class="vote-label">${escHtml(d.side_a_label)}</span>
        </button>
        <button class="vote-btn vb" onclick="castVote('b')" id="btn-b">
          <span class="vote-label">${escHtml(d.side_b_label)}</span>
        </button>
      </div>
      <div class="results-section" id="results">
        <div class="vote-bar-track">
          <div class="vote-bar-fill a-fill" id="bar-a" style="width:50%">50%</div>
          <div class="vote-bar-fill b-fill" id="bar-b" style="width:50%">50%</div>
        </div>
        <div class="vote-count" id="vote-count"></div>
        <div class="disagree-label" id="disagree-label"></div>
      </div>
    </div>`;

    // CTA banner
    html += `<div class="cta-banner fade-up">
      <div class="cta-headline">THINK THE AI IS WRONG?</div>
      <div class="cta-sub">Join The Colosseum and debate it yourself. Challenge the verdict. Build your record.</div>
      <a href="/colosseum-login.html" class="cta-btn">ENTER THE ARENA</a>
    </div>`;

    // Share bar
    html += `<div class="share-bar fade-up">
      <button class="share-btn" onclick="shareDebate('copy')">üìã Copy Link</button>
      <button class="share-btn" onclick="shareDebate('twitter')">ùïè Share</button>
      <button class="share-btn" onclick="shareDebate('native')">‚Üó Share</button>
    </div>`;

    // Footer
    html += `<div class="footer fade-up">
      AI-generated debate for entertainment. Scores are deliberately provocative.<br>
      <a href="/">The Colosseum</a> ¬∑ <a href="/colosseum-terms.html">Terms</a>
    </div>`;

    // Store debate data for voting
    window._debate = d;
    window._rounds = rounds;

    loading.style.display = 'none';
    app.innerHTML = html;
  }

  // ---- Vote ----
  window.castVote = async function(side) {
    const d = window._debate;
    if (!d) return;

    const btnA = document.getElementById('btn-a');
    const btnB = document.getElementById('btn-b');
    btnA.classList.add('voted');
    btnB.classList.add('voted');
    if (side === 'a') btnA.classList.add('winner');
    if (side === 'b') btnB.classList.add('winner');

    try {
      const { data } = await sb.rpc('cast_auto_debate_vote', {
        p_debate_id: d.id,
        p_fingerprint: getFingerprint(),
        p_voted_for: side,
        p_user_id: null,
      });

      if (data && data.error) {
        // Already voted ‚Äî show current results
        showResults(d.votes_a, d.votes_b, d.vote_count, d.winner, side);
        return;
      }

      if (data && data.success) {
        showResults(data.votes_a, data.votes_b, data.vote_count, d.winner, side);
      } else {
        showResults(d.votes_a + (side === 'a' ? 1 : 0), d.votes_b + (side === 'b' ? 1 : 0), d.vote_count + 1, d.winner, side);
      }
    } catch (err) {
      // Offline fallback ‚Äî show optimistic result
      showResults(d.votes_a + (side === 'a' ? 1 : 0), d.votes_b + (side === 'b' ? 1 : 0), d.vote_count + 1, d.winner, side);
    }
  };

  function showResults(votesA, votesB, total, aiWinner, userVote) {
    const results = document.getElementById('results');
    results.classList.add('show');

    const t = votesA + votesB || 1;
    const pctA = Math.round((votesA / t) * 100);
    const pctB = 100 - pctA;

    document.getElementById('bar-a').style.width = pctA + '%';
    document.getElementById('bar-a').textContent = pctA + '%';
    document.getElementById('bar-b').style.width = pctB + '%';
    document.getElementById('bar-b').textContent = pctB + '%';
    document.getElementById('vote-count').textContent = `${total} vote${total !== 1 ? 's' : ''} cast`;

    // Show rage-inducing label based on whether audience agrees with AI
    const audienceWinner = votesA > votesB ? 'a' : 'b';
    const label = document.getElementById('disagree-label');
    if (audienceWinner !== aiWinner) {
      label.textContent = 'üî• THE PEOPLE DISAGREE WITH THE AI';
    } else {
      label.textContent = 'The audience agrees with the AI... for now.';
    }
  }

  // ---- Share ----
  window.shareDebate = function(method) {
    const d = window._debate;
    if (!d) return;
    const url = window.location.href;
    const text = d.share_hook || `AI judged this debate: "${d.topic}" ‚Äî the result is wild.`;

    if (method === 'copy') {
      navigator.clipboard.writeText(url).then(() => {
        const btn = event.target;
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = 'üìã Copy Link', 2000);
      });
    } else if (method === 'twitter') {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
    } else if (method === 'native' && navigator.share) {
      navigator.share({ title: d.topic, text: text, url: url }).catch(() => {});
    } else {
      navigator.clipboard.writeText(url);
    }
  };

  // ---- Helpers ----
  function escHtml(str) {
    if (!str) return '';
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function getCatIcon(cat) {
    const icons = { sports:'üèüÔ∏è', politics:'üèõÔ∏è', entertainment:'üé¨', couples:'üíë', music:'üéµ', movies:'üé•', general:'üî•' };
    return icons[cat] || icons.general;
  }

  function showError(msg) {
    loading.style.display = 'none';
    app.innerHTML = `<div class="error-state">‚ùå ${escHtml(msg)}</div>
      <div style="text-align:center;margin-top:20px">
        <a href="/" class="join-btn">Go to The Colosseum</a>
      </div>`;
  }

  // ---- Go ----
  loadDebate();
})();
</script>

</body>
</html>
